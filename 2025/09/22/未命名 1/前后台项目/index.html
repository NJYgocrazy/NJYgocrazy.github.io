<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>后台管理项目 | NJYgocrazy</title><meta name="author" content="NJY"><meta name="copyright" content="NJY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Vue3相关技术栈搭建一个管理项目">
<meta property="og:type" content="article">
<meta property="og:title" content="后台管理项目">
<meta property="og:url" content="http://example.com/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="NJYgocrazy">
<meta property="og:description" content="Vue3相关技术栈搭建一个管理项目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s21.ax1x.com/2025/09/22/pV5SCUs.png">
<meta property="article:published_time" content="2025-09-22T12:54:20.521Z">
<meta property="article:modified_time" content="2025-09-22T12:54:20.521Z">
<meta property="article:author" content="NJY">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="Vue3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s21.ax1x.com/2025/09/22/pV5SCUs.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "后台管理项目",
  "url": "http://example.com/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE/",
  "image": "https://s21.ax1x.com/2025/09/22/pV5SCUs.png",
  "datePublished": "2025-09-22T12:54:20.521Z",
  "dateModified": "2025-09-22T12:54:20.521Z",
  "author": [
    {
      "@type": "Person",
      "name": "NJY",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '后台管理项目',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/top.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/ava.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s21.ax1x.com/2025/09/22/pV5SCUs.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">NJYgocrazy</span></a><a class="nav-page-title" href="/"><span class="site-name">后台管理项目</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">后台管理项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-22T12:54:20.521Z" title="发表于 2025-09-22 12:54:20">2025-09-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-22T12:54:20.521Z" title="更新于 2025-09-22 12:54:20">2025-09-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="后台管理项目"><a href="#后台管理项目" class="headerlink" title="后台管理项目"></a>后台管理项目</h1><h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><p>vue3+vite+vue-router+pinia+element-plus+echarts+mockjs+localstorage+axios</p>
<h2 id="项目职责"><a href="#项目职责" class="headerlink" title="项目职责"></a>项目职责</h2><ol>
<li>借助 element-plus + vue-router 负责整个系统 UI 结构实现单页面应用</li>
<li>针对左侧菜单权限问题，为了实现不同角色登录左侧菜单展示不同，采用了动态路由的实现</li>
<li>针对首页 echarts 表格的展示，缩小页面会导致表格展示不全的问题做了适配的处理</li>
<li>用到了面包屑缓存提升了用户的体验，主要解决用户在操作的时候不小心关闭浏览器，重新打开可以快速定位到上次浏览的页面</li>
<li>针对左侧路由和面包屑以及 tab 栏进行了联动处理</li>
<li>针对用户可能在 url 上输入非法地址做了 404 的路由处理</li>
<li>整个系统数据交互在前期植入了 mock 模拟数据，没有阻塞接口地址的调用，大大提升了后期联调的效率</li>
<li>针对 axios 进行二次封装，集中处理请求前和请求后的操作，其中还用到了 mock 开关和三种环境的配置，可以通过配置迅速打开和关闭 mock，系统可以自动根据当前环境调取不同的接口地址</li>
</ol>
<h2 id="计算属性参与-v-for"><a href="#计算属性参与-v-for" class="headerlink" title="计算属性参与 v-for"></a>计算属性参与 v-for</h2><p>在这里渲染侧边栏属性的时候我们用了这样的 v-for</p>
<p>list 数据部分</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = <span class="title function_">ref</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;House&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/mall&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;mall&quot;</span>,</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&quot;商品管理&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;VideoPlay&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;Mall&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;User&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;User&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/other&quot;</span>,</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&quot;其他&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;Location&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/page1&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;page1&quot;</span>,</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;页面1&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;Setting&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;Page1&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/page2&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;page2&quot;</span>,</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;页面2&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;Setting&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;Page2&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>script 部分</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> noChildren = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> list.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> !item.<span class="property">children</span>));</span><br><span class="line"><span class="keyword">const</span> hasChildren = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> list.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">children</span>));</span><br></pre></td></tr></table></figure>

<p>template 部分</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-menu-item</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">&quot;item in noChildren&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:index</span>=<span class="string">&quot;item.path&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">&quot;item.path&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">&quot;clickMenu(item)&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-sub-menu</span> <span class="attr">v-for</span>=<span class="string">&quot;item in hasChildren&quot;</span> <span class="attr">:index</span>=<span class="string">&quot;item.path&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.path&quot;</span>&gt;</span></span><br><span class="line">  &lt;/el-sub-menu</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="数据源计算"><a href="#数据源计算" class="headerlink" title="数据源计算"></a>数据源计算</h3><p><strong>Q1：nochildren 和 haschildren 是什么 我们为什么要用它们作为遍历的数据源</strong></p>
<p><code>filter</code> 是 JavaScript 数组的一个内置方法，用于<strong>筛选数组中符合条件的元素</strong>（它会遍历整个数组），并返回一个包含所有符合条件元素的新数组（不会改变原数组）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> 新数组 = 原数组.<span class="title function_">filter</span>(回调函数);</span><br></pre></td></tr></table></figure>

<p>所以首先 我们是用 filter 在 list 中渲染了我们需要的满足条件的元素</p>
<p>为什么要在前面添加上计算属性呢</p>
<p>这种方式的优势是：</p>
<ol>
<li>计算属性会自动响应 <code>list</code> 的变化，当数据更新时，视图会自动重新渲染</li>
<li>把过滤逻辑放在计算属性中，使模板更加简洁清晰</li>
<li>计算属性会缓存结果，比直接在模板中使用 <code>list.filter()</code> 性能更好</li>
</ol>
<h3 id="数据源区别"><a href="#数据源区别" class="headerlink" title="数据源区别"></a>数据源区别</h3><p><strong>Q2：nochildren 和 haschildren 的区别是什么</strong></p>
<p>在 Vue 的 <code>v-for</code> 中使用 <code>in noChildren</code> 和 <code>in hasChildren</code> 的核心区别在于<strong>遍历的数据源不同</strong>，这直接决定了渲染的内容差异，本质上是由你定义的两个计算属性的过滤逻辑决定的：</p>
<ol>
<li><p><strong>数据源的区别</strong></p>
<ul>
<li><code>v-for=&quot;item in noChildren&quot;</code>：遍历的是<strong>没有子项的元素集合</strong><br>对应的计算属性逻辑是 <code>list.value.filter(item =&gt; !item.children)</code>，即只保留 <code>children</code> 为假值（<code>null</code>、<code>undefined</code>、空数组 <code>[]</code> 等）的项。</li>
<li><code>v-for=&quot;item in hasChildren&quot;</code>：遍历的是<strong>有子项的元素集合</strong><br>对应的计算属性逻辑是 <code>list.value.filter(item =&gt; item.children)</code>，即只保留 <code>children</code> 为真值（非空数组、有实际内容的子项）的项。</li>
</ul>
</li>
<li><p><strong>实际渲染效果的区别</strong><br>假设你的 <code>list</code> 数据如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = <span class="title function_">ref</span>([</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;菜单1&quot;</span>, <span class="attr">children</span>: [] &#125;, <span class="comment">// 无有效子项（空数组）</span></span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;菜单2&quot;</span>, <span class="attr">children</span>: <span class="literal">null</span> &#125;, <span class="comment">// 无实际子项</span></span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;菜单3&quot;</span>, <span class="attr">children</span>: [&#123; <span class="attr">id</span>: <span class="number">31</span> &#125;] &#125;, <span class="comment">// 有子项</span></span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&quot;菜单4&quot;</span>, <span class="attr">children</span>: [&#123; <span class="attr">id</span>: <span class="number">41</span> &#125;] &#125;, <span class="comment">// 有子项</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>noChildren</code> 会渲染 <code>id=1</code> 和 <code>id=2</code> 的项（因为它们的 <code>children</code> 被判定为 “无”）</li>
<li>使用 <code>hasChildren</code> 会渲染 <code>id=3</code> 和 <code>id=4</code> 的项（因为它们的 <code>children</code> 被判定为 “有”）</li>
</ul>
</li>
<li><p><strong>业务场景的区别</strong><br>这种区分通常用于<strong>分类展示数据</strong>，也就是说对于有没有子项这件事分开展示，比如：</p>
<ul>
<li>菜单组件中，把 “叶子节点”（无下级菜单）和 “父节点”（有下级菜单）分开渲染，可能给它们设置不同的样式或交互逻辑</li>
<li>树形结构中，单独处理可展开的节点（有子项）和不可展开的节点（无子项）</li>
</ul>
</li>
</ol>
<p>简单说，两者的区别就是 <strong>“筛选出的数据集不同”</strong>，分别对应 “无子项” 和 “有子项” 的两种数据分类，最终会在页面上渲染出不同的内容。</p>
<h2 id="mockjs"><a href="#mockjs" class="headerlink" title="mockjs"></a>mockjs</h2><p>当我们拿到接口文档但是暂时还没有数据的时候</p>
<p>作为前端 我们应该学会制造假数据 但并不是我们直接写死一系列数据</p>
<p>而是应该吧交互请求的流程根据接口文档跑通 并且还要制造出数据</p>
<p>故而我们引入了一个工具 mockjs 可以拦截 Ajax 请求 把我们需要的假数据根据接口文档 制造出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mockjs</span><br></pre></td></tr></table></figure>

<p>我们在 src 下创建 api 文件夹 在其中创建 mock.js 用于实现拦截 ajax 请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Mock</span> <span class="keyword">from</span> <span class="string">&quot;mockjs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> homeApi <span class="keyword">from</span> <span class="string">&quot;./mockData/home.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.拦截的路径 2.拦截的方法 3.制造出的假数据</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="regexp">/api\/home\/getTableData/</span>, <span class="string">&quot;get&quot;</span>, homeApi.<span class="property">getTableData</span>);</span><br></pre></td></tr></table></figure>

<p>第一个位置是正则表达式作为拦截的路径（即后端给我们的后端接口的后半部分）</p>
<p>第二个部分是请求拦截的方法</p>
<p>第三个部分是我们提前预设好的假数据 我们一般会在 api 下放一个 mockData 文件夹来存放所有的 mock 数据 我们在 mockData 文件夹下创建一个 home.js 用于存放 home 组件部分的假数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">getTableData</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">tableData</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;oppo&quot;</span>,</span><br><span class="line">            <span class="attr">todayBuy</span>: <span class="number">500</span>,</span><br><span class="line">            <span class="attr">monthBuy</span>: <span class="number">3500</span>,</span><br><span class="line">            <span class="attr">totalBuy</span>: <span class="number">22000</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;vivo&quot;</span>,</span><br><span class="line">            <span class="attr">todayBuy</span>: <span class="number">300</span>,</span><br><span class="line">            <span class="attr">monthBuy</span>: <span class="number">2200</span>,</span><br><span class="line">            <span class="attr">totalBuy</span>: <span class="number">24000</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;苹果&quot;</span>,</span><br><span class="line">            <span class="attr">todayBuy</span>: <span class="number">800</span>,</span><br><span class="line">            <span class="attr">monthBuy</span>: <span class="number">4500</span>,</span><br><span class="line">            <span class="attr">totalBuy</span>: <span class="number">65000</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;小米&quot;</span>,</span><br><span class="line">            <span class="attr">todayBuy</span>: <span class="number">1200</span>,</span><br><span class="line">            <span class="attr">monthBuy</span>: <span class="number">6500</span>,</span><br><span class="line">            <span class="attr">totalBuy</span>: <span class="number">45000</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;三星&quot;</span>,</span><br><span class="line">            <span class="attr">todayBuy</span>: <span class="number">300</span>,</span><br><span class="line">            <span class="attr">monthBuy</span>: <span class="number">2000</span>,</span><br><span class="line">            <span class="attr">totalBuy</span>: <span class="number">34000</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;魅族&quot;</span>,</span><br><span class="line">            <span class="attr">todayBuy</span>: <span class="number">350</span>,</span><br><span class="line">            <span class="attr">monthBuy</span>: <span class="number">3000</span>,</span><br><span class="line">            <span class="attr">totalBuy</span>: <span class="number">22000</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>注意这里需要返回一个函数</p>
<p>当然做完上述的准备工作之后我们还需要到 main 里面去注册一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;@/api/mock.js&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>此后我们还是正常写 axios 来进行网络请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/api/home/getTableData&#x27;</span> <span class="comment">// 这里也是后端的接口文档</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        tableData.<span class="property">value</span> = res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">tableData</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>具体关于 axios 的部分我们写在下一个点中</p>
<h2 id="axios-请求"><a href="#axios-请求" class="headerlink" title="axios 请求"></a>axios 请求</h2><p>Axios 是一个基于 <em><a target="_blank" rel="noopener" href="https://javascript.info/promise-basics">promise</a></em> 网络请求库 （具体的介绍及用法直接看文档<a target="_blank" rel="noopener" href="https://www.axios-http.cn/">Axios 中文文档 | Axios 中文网</a>）</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>这里我们直接介绍基本用法(配置对象方式调用)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/api/home/getTableData&#x27;</span> <span class="comment">//请求的后端接口地址（此处为相对路径，实际会拼接基础路径，通常在 Axios 实例中配置）</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span> <span class="comment">// HTTP 请求方法（这里是 get，还可支持 post、put、delete 等）</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123; <span class="comment">// 这里的res是我们接收到的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//下述的判断都是根据我们接收到的res对象中的数据来写的 这些字段都是后端数据规定好了的</span></span><br><span class="line">    <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        tableData.<span class="property">value</span> = res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">tableData</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="二次封装"><a href="#二次封装" class="headerlink" title="二次封装"></a>二次封装</h3><p>但现在面临的问题是 在一个项目中我们可能需要很多相似的请求 请求中很多相似的部分需要写 那么我们可以通过二次封装 axios 来进行优化 通过<strong>拦截器</strong> <strong>在请求或响应被 then 或 catch 处理前拦截它们</strong> 从而实现对发送请求前和响应前的公共部分的一些判断 or 操作</p>
<p>文档中的拦截器如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// 2xx 范围内的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 超出 2xx 范围的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>当然这里面的操作我们都会根据实际情况操作</p>
<p>在实际开发中 我们可以给自定义的 axios 实例添加拦截器</p>
<p>因为有些场景需要多个 Axios 实例（如对接多个后端域名 有不同的认证方式 token） 每个实例我们配置独立的来拦截器 互不干扰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>();</span><br></pre></td></tr></table></figure>

<p>括号中可以传入配置对象（如请求基本路径等 后续如果用实例放松请求 URL 会自动拼接在该路径后面）</p>
<p>下面以该项目中的用法为例介绍用法</p>
<p>我们在 api 文件夹下创建 request 文件用于二次封装 axios</p>
<p><strong>1.添加请求拦截器和响应拦截器</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&quot;element-plus&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">NETWORK_ERROR</span> = <span class="string">&quot;网络错误，请稍后再试！&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; code, data, msg &#125; = res.<span class="property">data</span>;</span><br><span class="line">  <span class="keyword">if</span> (code === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(msg || <span class="variable constant_">NETWORK_ERROR</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(msg || <span class="variable constant_">NETWORK_ERROR</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可以看到，响应拦截器中实际上就是我们对</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123; <span class="comment">// 这里的res是我们接收到的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//下述的判断都是根据我们接收到的res对象中的数据来写的 这些字段都是后端数据规定好了的</span></span><br><span class="line">    <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        tableData.<span class="property">value</span> = res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">tableData</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这一段判断数据是否符合规则的代码的处理，这样在后续组件的调用中 就无需关注复杂的拦截逻辑</p>
<p><strong>2.封装请求函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  options.<span class="property">method</span> = options.<span class="property">method</span> || <span class="string">&quot;get&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">service</span>(options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<p>定义了一个 request 函数，用于统一调用 Axios 实例：</p>
<p>给请求参数 options 设置默认方法为 get（若未指定请求方法，则默认用 GET）。</p>
<p>调用 service(options) 发送请求，并返回 Promise 对象（方便后续用 async&#x2F;await 或 .then() 处理）。</p>
<p>导出 request 函数，供项目中其他文件导入使用。</p>
<p>！注意 <strong>后面我们在实际的 api 中都会使用这个 request 也就是会复用这些拦截器中的代码逻辑</strong> 这也就是二次封装的便利之处</p>
<p><code>options</code> 是传递给 <code>request</code> 函数的<strong>请求配置对象</strong>，它包含了发送 HTTP 请求所需的各种参数（如 URL、请求方法、参数等）。这个对象的结构与 Axios 原生的请求配置完全一致，是前端与后端接口通信的核心参数集合。</p>
<p><strong>3.封装 api</strong></p>
<p>进一步地 我们希望能够封装一下某个特定的 axios 请求的配置要求</p>
<p>即我们上面写的 options</p>
<p>为了满足这个想法 我们在 api 文件夹下面创建一个 api.js 文件</p>
<p><strong>用于整个项目 api 的统一管理</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//整个项目api的统一管理</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/api/request.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求首页左侧表格数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">getTableData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/api/home/getTableData&quot;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">    &#125;); <span class="comment">//request里面就放的是上面的options</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>显然这里我们放的就是 axios 请求里的配置部分 我们把每次请求的具体请求都统一放在这个文件中 方便统一管理</p>
<p><strong>4.全局注册</strong></p>
<p>当然在上述准备工作完成之后 我们需要到 main 里面 去注册挂载一下</p>
<p>这里我们把 api 全局注册 也对应着上面我们说 api 文件是管理整个项目 api 的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">&quot;@/api/api&quot;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$api</span> = api;</span><br></pre></td></tr></table></figure>

<ol>
<li>**<code>app.config.globalProperties</code>**：<ul>
<li>这是 Vue3 提供的一个对象，用于注册<strong>全局可访问的属性</strong>。</li>
<li>所有添加到这个对象上的属性，会被注入到每个组件的实例中，类似于 Vue2 中的 <code>Vue.prototype</code>。</li>
</ul>
</li>
<li>**<code>$api</code>**：<ul>
<li>是自定义的全局属性名（通常以 <code>$</code> 开头，这是 Vue 生态的约定，用于区分全局属性和组件自身属性）。</li>
<li>命名为 <code>$api</code> 通常是因为它挂载的是项目中所有接口请求方法的集合对象。</li>
</ul>
</li>
</ol>
<p><strong>5.实际使用</strong></p>
<p>我们在实际需要请求的组件中使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, getCurrentInstance, onMounted &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; proxy &#125; = <span class="title function_">getCurrentInstance</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getCurrentInstance()</code> 是 Vue3 提供的一个内置 API，用于获取当前组件的实例对象（Instance）。</li>
<li>解构出的 <code>proxy</code> 是组件实例的<strong>代理对象</strong>，它等价于 Vue2 中的 <code>this</code>，可以通过它访问组件的属性、方法、全局注册的对象等。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getTableData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">getTableData</span>();</span><br><span class="line">  tableData.<span class="property">value</span> = data.<span class="property">tableData</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>异步请求</p>
<p>proxy 获取全局 api 然后调用 api 中我们封装的 getTableData() 获得到 data</p>
<p>然后把之前定义的对象 tableData 赋值为我们 data 中拿到的 tableData</p>
<p>就实现了对 axios 的二次封装与调用</p>
<h3 id="引入配置文件"><a href="#引入配置文件" class="headerlink" title="引入配置文件"></a>引入配置文件</h3><p>在实际的开发工作中 实际上我们的请求地址可能有很多个 （譬如测试场景 开发场景 它们的 url 就是不同的） 所以我们希望有一个方法能够快速简便地改变 url 所以我们引入配置文件来预设这些地址</p>
<p>在 src 目录下创建一个 config 文件夹用于存放配置文件</p>
<p>index.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 环境配置文件</span><br><span class="line"> * 一般在企业级项目里面有三个环境</span><br><span class="line"> * 开发环境</span><br><span class="line"> * 测试环境</span><br><span class="line"> * 线上环境</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 当前的环境</span><br><span class="line">const env = import.meta.env.MODE || &#x27;prod&#x27;</span><br><span class="line"></span><br><span class="line">const EnvConfig = &#123;</span><br><span class="line">  development: &#123;</span><br><span class="line">    baseApi: &#x27;/api&#x27;,</span><br><span class="line">    mockApi: &#x27;https://mock.apifox.cn/m1/4068509-0-default/api&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  test: &#123;</span><br><span class="line">    baseApi: &#x27;//test.future.com/api&#x27;,</span><br><span class="line">    mockApi: &#x27;https://mock.apifox.cn/m1/4068509-0-default/api&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  pro: &#123;</span><br><span class="line">    baseApi: &#x27;//future.com/api&#x27;,</span><br><span class="line">    mockApi: &#x27;https://mock.apifox.cn/m1/4068509-0-default/api&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  env,</span><br><span class="line">  mock:false, // 对于mock测试的开关 即是否使用mock地址 在后续的代码逻辑中可以看到</span><br><span class="line">  ...EnvConfig[env]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>import.meta.env.MODE：是 Vite 构建工具提供的环境变量，用于获取当前项目运行的环境模式（如 development，test，prod）。<ul>
<li>开发环境通常通过 <code>npm run dev</code> 启动，<code>MODE</code> 为 <code>development</code>；</li>
<li>生产环境通过 <code>npm run build</code> 构建，<code>MODE</code> 为 <code>production</code>（这里代码用 <code>prod</code> 表示）；</li>
<li>测试环境需额外配置，<code>MODE</code> 为 <code>test</code>。</li>
</ul>
</li>
<li><code>|| &#39;prod&#39;</code>：设置默认值，若无法获取环境模式，默认使用生产环境（<code>prod</code>），避免配置缺失。</li>
<li>最终 <code>env</code> 变量存储当前环境标识（如 <code>development</code>）。</li>
</ul>
<p>剩下的就比较易懂了 主要是在这里直接预设好几个地址</p>
<p>对应的 我们对 request 请求进行一些改变让其更符合工程化的要求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  options.<span class="property">method</span> = options.<span class="property">method</span> || <span class="string">&quot;get&quot;</span>;</span><br><span class="line">  <span class="comment">//关于get请求参数的调整 我们都统一成data请求</span></span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">method</span>.<span class="title function_">toLowerCase</span>() === <span class="string">&quot;get&quot;</span>) &#123;</span><br><span class="line">    options.<span class="property">params</span> = options.<span class="property">data</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//对mock的开关做一个处理</span></span><br><span class="line">  <span class="keyword">let</span> isMock = config.<span class="property">mock</span>; <span class="comment">//默认值</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> options.<span class="property">mock</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    isMock = options.<span class="property">mock</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//针对环境做一个处理</span></span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">env</span> === <span class="string">&quot;prod&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">//不能用mock</span></span><br><span class="line">    service.<span class="property">defaults</span>.<span class="property">baseURL</span> = config.<span class="property">baseApi</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//开发环境</span></span><br><span class="line">    service.<span class="property">defaults</span>.<span class="property">baseURL</span> = isMock ? config.<span class="property">mockApi</span> : config.<span class="property">baseApi</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">service</span>(options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面分条进行解释</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.<span class="property">method</span>.<span class="title function_">toLowerCase</span>() === <span class="string">&quot;get&quot;</span>) &#123;</span><br><span class="line">  options.<span class="property">params</span> = options.<span class="property">data</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>统一处理 GET 请求的参数格式</strong>，将开发者传入的 <code>data</code> 参数自动转换为 GET 请求所需的 <code>params</code> 参数，简化请求调用时的参数传递逻辑。</p>
<p>具体来说：</p>
<ol>
<li><strong>判断请求方法</strong><br><code>options.method.toLowerCase() === &quot;get&quot;</code> 用于检查当前请求是否为 GET 方法（忽略大小写，如 <code>Get</code>、<code>GET</code> 都会被识别）。</li>
<li><strong>参数转换</strong><br>若为 GET 请求，则执行 <code>options.params = options.data</code>：<ul>
<li>在 Axios 中，GET 请求的参数需要放在 <code>params</code> 属性中（会被自动拼接到 URL 后面，格式为 <code>?key=value</code>）。</li>
<li>而 POST&#x2F;PUT 等请求的参数通常放在 <code>data</code> 属性中（作为请求体发送）。</li>
<li>这段代码允许开发者在调用 GET 请求时，也像 POST 那样使用 <code>data</code> 传递参数，然后自动转换为 <code>params</code>，减少记忆负担。</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对mock的开关做一个处理</span></span><br><span class="line"><span class="keyword">let</span> isMock = config.<span class="property">mock</span>; <span class="comment">//默认值</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> options.<span class="property">mock</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">  isMock = options.<span class="property">mock</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码在配置文件中导出了 mock 用于控制是否是 mock 测试 所以我们弄一个开关来处理这个变量</p>
<p>但同时 考虑到某些组件请求时可能有单独的 mock 要求 故而我们在 api 里也定义一个 mock</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getTableData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/home/getTableData&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">mock</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>来实现完善的 mock 开关（用的是覆盖原值的方式）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//针对环境做一个处理</span></span><br><span class="line"><span class="keyword">if</span> (config.<span class="property">env</span> === <span class="string">&quot;prod&quot;</span>) &#123;</span><br><span class="line">  <span class="comment">//不能用mock</span></span><br><span class="line">  service.<span class="property">defaults</span>.<span class="property">baseURL</span> = config.<span class="property">baseApi</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//开发环境</span></span><br><span class="line">  service.<span class="property">defaults</span>.<span class="property">baseURL</span> = isMock ? config.<span class="property">mockApi</span> : config.<span class="property">baseApi</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>根据当前项目环境（生产 &#x2F; 非生产）动态设置 Axios 实例的基础请求地址</strong></p>
<ul>
<li><strong>判断是否为生产环境</strong>：<br><code>if (config.env === &#39;prod&#39;)</code> 检查当前环境是否为生产环境（<code>prod</code>）。<br>生产环境通常是项目上线后用户实际使用的环境，必须调用真实后端接口，禁止使用 mock 数据，否则会导致功能异常。</li>
<li><strong>生产环境处理</strong>：<br><code>service.defaults.baseURL = config.baseApi</code><br>为 Axios 实例的默认基础地址赋值为生产环境的真实接口地址（如 <code>//future.com/api</code>），确保所有请求都指向真实后端服务。</li>
<li><strong>非生产环境处理</strong>：<br><code>else</code> 分支涵盖开发环境（<code>development</code>）和测试环境（<code>test</code>），这些环境中可能需要使用 mock 数据进行开发或测试。<br><code>service.defaults.baseURL = isMock ? config.mockApi : config.baseApi</code> 是一个三元表达式：<ul>
<li>若 <code>isMock</code> 为 <code>true</code>（启用 mock），则使用模拟接口地址（<code>config.mockApi</code>，如 Apifox 的 mock 服务地址）；</li>
<li>若 <code>isMock</code> 为 <code>false</code>（不启用 mock），则使用对应环境的真实接口地址（<code>config.baseApi</code>，如开发环境的 <code>/api</code> 或测试环境的 <code>//test.future.com/api</code>）。</li>
</ul>
</li>
</ul>
<p>由于我们这里给实例的基础地址赋值了 所以对应的 我们要给实例文件一个 baseURL</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: config.<span class="property">baseApi</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>需要说明的一点是 上述我们写的 config.xxapi 都是<strong>根据当前 config 的 env（环境）自动匹配的对应环境的 api</strong> 也就对应着我们在配置文件中分了三种情况写 api</p>
<h2 id="echarts-表格"><a href="#echarts-表格" class="headerlink" title="echarts 表格"></a>echarts 表格</h2><p>在此项目中我们实现了三个图表 折线图柱状图饼状图的渲染<img src="/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE.assets/image-20250915110450957.png" alt="image-20250915110450957"></p>
<p><a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/index.html">Apache ECharts</a> 更详实的用法看官方文档</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>首先我们引入库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install echarts</span><br></pre></td></tr></table></figure>

<p>基于准备好的 dom 初始化 echarts 实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//譬如我们可以通过document事件找到节点</span></span><br><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;main&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以像该项目一样 需要在 HTML 中先定义一个 &lt;div&gt; 节点，并且通过 CSS 使得该节点具有宽度和高度 我们给这个节点添加ref属性 就可以在proxy中找到了</span></span><br><span class="line"><span class="keyword">const</span> threeEchart = echarts.<span class="title function_">init</span>(proxy.<span class="property">$refs</span>[<span class="string">&quot;videoEchart&quot;</span>]);</span><br></pre></td></tr></table></figure>

<p>需要注意的是，使用这种方法在调用 echarts.init 时需保证容器已经有宽度和高度了。</p>
<p>初始化的时候，传入该节点，图表的大小默认即为该节点的大小，除非声明了 <code>opts.width</code> 或 <code>opts.height</code> 将其覆盖。</p>
<p><strong>图表的引入</strong></p>
<p>可以按需引入 也可以全部引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 echarts 核心模块，核心模块提供了 echarts 使用必须要的接口。</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&quot;echarts/core&quot;</span>;</span><br><span class="line"><span class="comment">// 引入柱状图图表，图表后缀都为 Chart</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BarChart</span> &#125; <span class="keyword">from</span> <span class="string">&quot;echarts/charts&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="配置表格样式与数据"><a href="#配置表格样式与数据" class="headerlink" title="配置表格样式与数据"></a>配置表格样式与数据</h3><p>每一种表格都有相应的配置项 每个配置项包含的内容有样式内容和对应数据</p>
<p>详细见配置手册 <a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/option.html#title">Documentation - Apache ECharts</a></p>
<p><strong>柱状图配置</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>title</td>
<td>标题组件，用于定义图表的标题。它包含了 text（标题文本）、left（标题水平位置）、top（标题垂直位置）等属性</td>
</tr>
<tr>
<td>tooltip</td>
<td>提示框组件，用于展示图表中某个数据项的详细信息。可以设置 trigger（触发类型）、axisPointer（指示器配置）等</td>
</tr>
<tr>
<td>legend</td>
<td>图例组件，展示了不同系列的标记、颜色和名字。可以通过 data 属性定义图例的数据数组</td>
</tr>
<tr>
<td>grid</td>
<td>网格组件，用于控制图表的网格，包括 left、right、top、bottom、width 和 height 等属性来控制网格的位置和大小</td>
</tr>
<tr>
<td>xAxis</td>
<td>X 轴配置，通常用于显示类别数据。可以设置 type（轴类型）、data（类别数据数组）、axisLabel（轴标签样式）、axisLine（轴线样式）等</td>
</tr>
<tr>
<td>yAxis</td>
<td>Y 轴配置，通常用于显示数值数据。可以设置 type（轴类型）、name（轴名称）、axisLabel（轴标签样式）、splitLine（分隔线样式）等</td>
</tr>
<tr>
<td>series</td>
<td>系列列表，用于定义图表的数据内容。每个系列通过 type 指定为 ‘bar’ 来表示柱状图。data 属性用于定义系列中的数据点，还可配置 barWidth（柱宽）、barGap（柱间距）等</td>
</tr>
<tr>
<td>color</td>
<td>用于定义系列的颜色，可以是一个具体的颜色值，也可以是一个颜色数组，用于多彩柱状图</td>
</tr>
<tr>
<td>animation</td>
<td>动画配置，用于设置图表初始化或数据更新时的动画效果。可以设置 duration（动画时长）和 easing（缓动效果）</td>
</tr>
<tr>
<td>dataset</td>
<td>数据集配置，用于定义图表的数据源。source 属性用于指定外部数据，transform 属性用于对数据进行处理</td>
</tr>
<tr>
<td>toolbox</td>
<td>工具箱组件，提供了数据视图、下载等功能。可以设置 feature 属性来定义工具箱中的功能（如导出图片、数据视图、重置等）</td>
</tr>
<tr>
<td>dataZoom</td>
<td>数据区域缩放组件，用于放大和缩小图表的显示区域。可以设置 type（数据区域缩放的类型，如 ‘inside’ 或’slider’）</td>
</tr>
<tr>
<td>visualMap</td>
<td>视觉映射组件，用于根据数据值大小对图形的颜色、大小等进行映射。可以设置 min、max（数据的最小值和最大值）和 orient（布局方向）等</td>
</tr>
<tr>
<td>itemStyle</td>
<td>柱状图的样式配置，可设置颜色、边框、圆角等（如 borderRadius 可设置柱子圆角）</td>
</tr>
<tr>
<td>label</td>
<td>柱状图上的标签配置，可设置是否显示（show）、位置（position）、格式化（formatter）等</td>
</tr>
<tr>
<td>markPoint</td>
<td>标记点配置，用于标记最大值、最小值等特定数据点</td>
</tr>
<tr>
<td>markLine</td>
<td>标记线配置，用于标记平均值、自定义值等参考线</td>
</tr>
<tr>
<td>barCategoryGap</td>
<td>不同类目之间的间距，默认为 ‘20%’</td>
</tr>
<tr>
<td>barGap</td>
<td>同类别下系列间的间距，默认为 ‘30%’</td>
</tr>
</tbody></table>
<p><strong>折线图配置</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>title</td>
<td>标题组件，用于定义图表的标题。它包含了 text（标题文本）、left（标题水平位置）、top（标题垂直位置）等属性</td>
</tr>
<tr>
<td>tooltip</td>
<td>提示框组件，用于展示图表中某个数据项的详细信息。可以设置 trigger（触发类型）、axisPointer（指示器配置）等</td>
</tr>
<tr>
<td>legend</td>
<td>图例组件，展示了不同系列的标记、颜色和名字。可以通过 data 属性定义图例的数据数组。</td>
</tr>
<tr>
<td>grid</td>
<td>网格组件，用于控制图表的网格，包括 left、right、top、bottom、width 和 height 等属性来控制网格的位置和大小</td>
</tr>
<tr>
<td>xAxis</td>
<td>X 轴配置，通常用于显示类目数据。可以设置 type（轴类型）、data（类目数据数组）、axisLabel（轴标签样式）等</td>
</tr>
<tr>
<td>yAxis</td>
<td>Y 轴配置，通常用于显示数值数据。可以设置 type（轴类型）、name（轴名称）、axisLabel（轴标签样式）等</td>
</tr>
<tr>
<td>series</td>
<td>系列列表，用于定义图表的数据内容。对于折线图，type 应设置为 ‘line’。data 属性用于定义系列中的数据点</td>
</tr>
<tr>
<td>color</td>
<td>用于定义系列的颜色，可以是一个具体的颜色值，也可以是一个颜色数组，用于多彩折线图</td>
</tr>
<tr>
<td>animation</td>
<td>动画配置，用于设置图表初始化或数据更新时的动画效果。可以设置 duration（动画时长）和 easing（缓动效果）</td>
</tr>
<tr>
<td>dataset</td>
<td>数据集配置，用于定义图表的数据源。source 属性用于指定外部数据，transform 属性用于对数据进行处理</td>
</tr>
<tr>
<td>dataZoom</td>
<td>数据区域缩放组件，用于放大和缩小图表的显示区域。可以设置 type（数据区域缩放的类型，如 ‘inside’ 或’slider’）</td>
</tr>
<tr>
<td>visualMap</td>
<td>视觉映射组件，用于根据数据值大小对图形的颜色、大小等进行映射。可以设置 min、max（数据的最小值和最大值）和 orient（布局方向）等</td>
</tr>
<tr>
<td>lineStyle</td>
<td>折线样式配置，可以设置折线的宽度、类型、颜色等。例如，{color: ‘#ff0000’, width: 2} 表示红色的折线，宽度为 2</td>
</tr>
<tr>
<td>areaStyle</td>
<td>填充样式配置，用于设置折线图下方的填充颜色和透明度。例如，{color: ‘rgba (255, 0, 0, 0.3)’} 表示红色的填充，透明度为 0.3</td>
</tr>
<tr>
<td>markLine 或 markPoint</td>
<td>用于在图表中标记特定的数据点或数据线。可以设置 data 属性来定义标记的内容和位置</td>
</tr>
</tbody></table>
<p><strong>饼状图配置</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>title</td>
<td>标题组件，用于定义图表的标题。它包含了 text（标题文本）、left（标题水平位置）、top（标题垂直位置）等属性</td>
</tr>
<tr>
<td>tooltip</td>
<td>提示框组件，用于展示图表中某个数据项的详细信息。可以设置 trigger（触发类型）、axisPointer（指示器配置）等</td>
</tr>
<tr>
<td>legend</td>
<td>图例组件，展示了不同系列的标记、颜色和名字。可以通过 data 属性定义图例的数据数组</td>
</tr>
<tr>
<td>grid</td>
<td>网格组件，用于控制图表的网格，包括 left、right、top、bottom、width 和 height 等属性来控制网格的位置和大小</td>
</tr>
<tr>
<td>radius</td>
<td>饼图的半径，可以是绝对值，也可以是相对于容器大小的百分比。可以设置为数组，分别表示内半径和外半径，用于创建环形图</td>
</tr>
<tr>
<td>center</td>
<td>饼图的中心位置，可以是绝对值，也可以是百分比。通常设置为 [‘50%’, ‘50%’] 表示居中</td>
</tr>
<tr>
<td>series</td>
<td>系列列表，用于定义图表的数据内容。对于饼图，type 应设置为 ‘pie’。data 属性用于定义系列中的数据点，通常包括 value（数据值）和 name（数据项名称）</td>
</tr>
<tr>
<td>color</td>
<td>用于定义系列的颜色，可以是一个具体的颜色值，也可以是一个颜色数组，用于多彩饼图</td>
</tr>
<tr>
<td>label</td>
<td>标签的样式配置，包括 show（是否显示标签）、position（标签位置）、formatter（标签内容格式化器）等</td>
</tr>
<tr>
<td>labelLine</td>
<td>标签直线的样式配置，用于连接标签和对应的扇形块</td>
</tr>
<tr>
<td>itemStyle</td>
<td>扇形块的样式配置，可以设置 borderColor（扇形块边框颜色）、borderWidth（扇形块边框宽度）等</td>
</tr>
<tr>
<td>emphasis</td>
<td>鼠标悬停或高亮时的系列样式，可以用来设置高亮时的标签、扇形块等的样式</td>
</tr>
<tr>
<td>roseType</td>
<td>用于设置是否为南丁格尔图（半径不等的饼图），可以取值 ‘radius’ 或 ‘area’</td>
</tr>
<tr>
<td>sort</td>
<td>是否根据数据值进行排序，可以取值 ‘asc’（升序）、’desc’（降序）或 false（不排序）</td>
</tr>
<tr>
<td>hoverAnimation</td>
<td>鼠标悬停时的动画效果，可以设置为 true（开启）或 false（关闭）</td>
</tr>
</tbody></table>
<p>xAxis 与 yAxis 中的 data 属性用于储存 x，y 轴中显示的数据内容</p>
<p>series 中的数据用于储存图表中每一个点的数据内容（可能是一个柱子 一条线 一块饼）</p>
<p>在该项目中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xOptions.<span class="property">xAxis</span>.<span class="property">data</span> = orderData.<span class="property">date</span>;</span><br><span class="line">xOptions.<span class="property">series</span> = <span class="title class_">Object</span>.<span class="title function_">keys</span>(orderData.<span class="property">data</span>[<span class="number">0</span>]).<span class="title function_">map</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: val,</span><br><span class="line">    <span class="attr">data</span>: orderData.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item[val]),</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object.keys(orderData.data[0])</span><br></pre></td></tr></table></figure>

<p><code>Object.keys(对象)</code> 是 JavaScript 的内置方法，用于<strong>获取对象中所有自身可枚举属性的键名</strong>，并返回一个包含这些键名的数组。</p>
<p><code>orderData.data[0]</code> 是一个对象（比如 <code>&#123; 销量: 100, 利润: 20 &#125;</code>），那么 <code>Object.keys()</code> 会返回这个对象的所有键名组成的数组（比如 <code>[&#39;销量&#39;, &#39;利润&#39;]</code>）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xOptions.series = Object.keys(orderData.data[0]).map(val =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        name: val,</span><br><span class="line">        data: orderData.data.map(item =&gt; item[val]),</span><br><span class="line">        type: &#x27;line&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>map()</code> 是数组的方法，用于<strong>遍历数组并返回一个新数组</strong>，新数组的元素是原数组元素经过回调函数处理后的结果。</p>
<p>代码中用到了两次 <code>map()</code>：</p>
<ul>
<li>外层 <code>map()</code>：遍历 <code>Object.keys()</code> 返回的键名数组（比如 <code>[&#39;销量&#39;, &#39;利润&#39;]</code>），为每个键名生成一个图表系列配置。（因为 series 的数据是若干个点 故而我们给每一个点生成一个图表系列配置）</li>
<li>内层 <code>map()</code>：遍历 <code>orderData.data</code> 数组（数据源数组），从每个数据项中提取当前键名对应的值，组成该系列的数据数组。<code>val</code> 是 “要取的属性名”，<code>item[val]</code> 是 “从每条数据中取这个属性名对应的值”，最终通过 <code>map</code> 收集成一个数组，作为当前系列的 <code>data</code>。</li>
</ul>
<h3 id="渲染图表"><a href="#渲染图表" class="headerlink" title="渲染图表"></a>渲染图表</h3><p>最后我们需要渲染一下这个图表</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">twoEchart.<span class="title function_">setOption</span>(xOptions);</span><br></pre></td></tr></table></figure>

<h3 id="响应容器大小的变化"><a href="#响应容器大小的变化" class="headerlink" title="响应容器大小的变化"></a>响应容器大小的变化</h3><p><strong>监听图表容器的大小并改变图表大小</strong></p>
<p>在有些场景下，我们希望当容器大小改变时，图表的大小也相应地改变。</p>
<p>比如，图表容器是一个高度为 400px、宽度为页面 100% 的节点，你希望在浏览器宽度改变的时候，始终保持图表宽度是页面的 100%。</p>
<p>这种情况下，可以监听页面的 <code>resize</code> 事件获取浏览器大小改变的事件，然后调用 <a target="_blank" rel="noopener" href="https://echarts.apache.org/api.html#echartsInstance.resize"><code>echartsInstance.resize</code></a> 改变图表的大小。</p>
<p>这里我们使用的是浏览器原生 API 来监视元素的尺寸变化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听页面的变化</span></span><br><span class="line"><span class="comment">//如果监听的容器大小发生变化 改变了之后 会执行回调函数</span></span><br><span class="line">observer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">ResizeObserver</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  oneEchart.<span class="title function_">resize</span>();</span><br><span class="line">  twoEchart.<span class="title function_">resize</span>();</span><br><span class="line">  threeEchart.<span class="title function_">resize</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//容器存在</span></span><br><span class="line"><span class="keyword">if</span> (proxy.<span class="property">$refs</span>[<span class="string">&quot;echart&quot;</span>]) &#123;</span><br><span class="line">  observer.<span class="property">value</span>.<span class="title function_">observe</span>(proxy.<span class="property">$refs</span>[<span class="string">&quot;echart&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (proxy.<span class="property">$refs</span>[<span class="string">&quot;userEchart&quot;</span>]) &#123;</span><br><span class="line">  observer.<span class="property">value</span>.<span class="title function_">observe</span>(proxy.<span class="property">$refs</span>[<span class="string">&quot;userEchart&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (proxy.<span class="property">$refs</span>[<span class="string">&quot;videoEchart&quot;</span>]) &#123;</span><br><span class="line">  observer.<span class="property">value</span>.<span class="title function_">observe</span>(proxy.<span class="property">$refs</span>[<span class="string">&quot;videoEchart&quot;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ResizeObserver 是浏览器原生的一个 API，用于监听元素的尺寸变化（比如容器宽度 &#x2F; 高度改变）。当被观察的元素大小发生变化时，会触发传入的回调函数。</p>
<h2 id="实现搜索功能"><a href="#实现搜索功能" class="headerlink" title="实现搜索功能"></a>实现搜索功能</h2><h3 id="页面结构"><a href="#页面结构" class="headerlink" title="页面结构"></a>页面结构</h3><p>实现了一个基于 Element UI 的搜索功能，主要通过表单输入、参数传递和接口调用来完成数据筛选</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">lable</span>=<span class="string">&quot;请输入&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;formInline.keyWord&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleSearch&quot;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是一个 element UI 的表单按钮组件 点击按钮时会触发 handlesearch 方法 这是搜索功能的入口</p>
<p>并且用一个 v-model 双向绑定了我们需要的输入数据 便于我们后续对搜索关键词的处理</p>
<h3 id="处理输入数据"><a href="#处理输入数据" class="headerlink" title="处理输入数据"></a>处理输入数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存储表单输入的搜索关键词</span></span><br><span class="line"><span class="keyword">const</span> formInline = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">keyWord</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// 绑定到输入框的v-model</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储接口请求参数</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// 要搜索的姓名关键词</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>reactive</code>创建响应式对象，确保数据变化能被 Vue 追踪</li>
<li><code>formInline.keyWord</code>用于绑定搜索输入框的值</li>
<li><code>config</code>对象存储实际传给接口的参数</li>
</ul>
<p>定义 formInline.keyWord 为储存 v-model 绑定的输入数据</p>
<p>这个 config 的作用是我们需要在点击搜索后 将输入数据扔回 axios 请求中返回匹配的数据 也就是说 这个 config 是需要传入 axios 请求的</p>
<h3 id="搜索逻辑"><a href="#搜索逻辑" class="headerlink" title="搜索逻辑"></a>搜索逻辑</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleSearch</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 将表单输入的关键词赋值给接口参数</span></span><br><span class="line">  config.<span class="property">name</span> = formInline.<span class="property">keyWord</span>;</span><br><span class="line">  <span class="comment">// 调用获取数据的方法</span></span><br><span class="line">  <span class="title function_">getUserData</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是搜索按钮的点击事件处理函数</li>
<li>核心逻辑是将用户输入的搜索关键词（<code>formInline.keyWord</code>）赋值给接口请求参数（<code>config.name</code>）</li>
<li>然后调用<code>getUserData</code>方法重新获取数据</li>
</ul>
<p>像上面说的 我们为 name 赋值 从而实现在数据中搜索 keyword</p>
<p>那么按照之前的逻辑 我们只需要重写一下 getUserData 让其处理一下这个传入的参数就可以了</p>
<h3 id="数据请求与渲染"><a href="#数据请求与渲染" class="headerlink" title="数据请求与渲染"></a>数据请求与渲染</h3><p>首先我们给 getUserData 的 api 加一个返回值 让其可以处理我们传入的 config</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getUserData</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/home/getUserData&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">mock</span>: <span class="literal">false</span>,</span><br><span class="line">        data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>那么对应地 我们也需要在组件代码里传入这个参数</p>
<p>我们根据传入的 config 的 name 去数据中匹配元素 从而渲染到 tableData 里 这就是实现搜索结果的详细过程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getUserData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 调用API接口，传入包含搜索关键词的config参数</span></span><br><span class="line">  <span class="keyword">let</span> data = <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">getUserData</span>(config);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理返回的数据，映射到表格数据</span></span><br><span class="line">  tableData.<span class="property">value</span> = data.<span class="property">list</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> (&#123;</span><br><span class="line">    ...item,</span><br><span class="line">    <span class="comment">// 转换性别为文字显示</span></span><br><span class="line">    <span class="attr">sexLabel</span>: item.<span class="property">sex</span> === <span class="number">1</span> ? <span class="string">&quot;男&quot;</span> : <span class="string">&quot;女&quot;</span>,</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在写完这里的时候我有一个疑问 我们为了实现这个功能在这里添加了一个需要传入的参数 config 那么当一开始要渲染数据的时候是怎么处理的呢？</p>
<p>实际上 config 这里的 name 的初始化是空字符串 所以是不会对初始数据请求造成影响的</p>
<h2 id="实现分页功能"><a href="#实现分页功能" class="headerlink" title="实现分页功能"></a>实现分页功能</h2><p>实际上 这里的分页功能跟搜索功能是非常像的 都是用户进行一个操作过后 需要根据这个操作重新渲染页面 所以我们依旧把分页的相关数据储存在 config 内 是同理的 在需要渲染的时候重新传入 重新请求数据即可</p>
<h3 id="页面结构-1"><a href="#页面结构-1" class="headerlink" title="页面结构"></a>页面结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;pager&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">background</span></span></span><br><span class="line"><span class="tag">  <span class="attr">layout</span>=<span class="string">&quot;prev, pager, next&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:total</span>=<span class="string">&quot;config.total&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">current-change</span>=<span class="string">&quot;handleChange&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这是 Element UI 提供的分页组件<code>&lt;el-pagination&gt;</code></li>
<li>核心属性说明：<ul>
<li><code>:total=&quot;config.total&quot;</code>：绑定总数据条数，告诉分页组件一共有多少条数据（从后端接口获取）</li>
<li><code>layout=&quot;prev, pager, next&quot;</code>：定义分页组件的布局，包含 “上一页”、”页码”、”下一页”</li>
<li><code>@current-change=&quot;handleChange&quot;</code>：页码改变时触发的事件，会把新页码作为参数传递</li>
<li><code>size=&quot;small&quot;</code>：设置分页组件为小尺寸</li>
<li><code>background</code>：为分页按钮添加背景色</li>
</ul>
</li>
</ul>
<h3 id="分页参数管理"><a href="#分页参数管理" class="headerlink" title="分页参数管理"></a>分页参数管理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// 搜索关键词</span></span><br><span class="line">  <span class="attr">total</span>: <span class="number">0</span>, <span class="comment">// 总数据条数（由后端返回）</span></span><br><span class="line">  <span class="attr">page</span>: <span class="number">1</span>, <span class="comment">// 当前页码，默认第一页</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>config 对象中专门用两个属性管理分页相关数据：<ul>
<li><code>page</code>：记录当前需要展示的页码，会传递给后端接口</li>
<li><code>total</code>：存储后端返回的总数据条数，用于分页组件计算总页数</li>
</ul>
</li>
</ul>
<p>这个传入逻辑跟刚才的搜索功能实现的逻辑是一样的</p>
<h3 id="页码切换逻辑"><a href="#页码切换逻辑" class="headerlink" title="页码切换逻辑"></a>页码切换逻辑</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// val是新的页码（由分页组件传递过来）</span></span><br><span class="line">  config.<span class="property">page</span> = val; <span class="comment">// 更新当前页码</span></span><br><span class="line">  <span class="title function_">getUserData</span>(); <span class="comment">// 重新请求数据</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是页码改变时的事件处理函数</li>
<li>当用户点击分页组件的 “上一页”、”下一页” 或具体页码时：<ol>
<li>分页组件会把选中的新页码通过<code>val</code>参数传递给<code>handleChange</code></li>
<li>更新<code>config.page</code>为新页码</li>
<li>调用<code>getUserData()</code>重新请求数据（此时会带上新的页码参数）</li>
</ol>
</li>
</ul>
<h2 id="实现删除功能"><a href="#实现删除功能" class="headerlink" title="实现删除功能"></a>实现删除功能</h2><h3 id="页面结构-2"><a href="#页面结构-2" class="headerlink" title="页面结构"></a>页面结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> #=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>删除&lt;/el-button</span><br><span class="line">  &gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>这是表格中每行数据的操作按钮区域（使用了 Element UI 的插槽语法）</p>
</li>
<li><p><code>scope.row</code> 表示当前行的数据对象（包含该用户的完整信息，如<code>id</code>、<code>name</code>等）</p>
<p>scope 是一个对象，由表格组件自动传入，包含当前行的所有信息，主要属性有：</p>
<p><code>scope.row</code>：当前行的数据对象（最重要的属性），比如包含 <code>id</code>、<code>name</code>、<code>age</code> 等字段。</p>
<p><code>scope.$index</code>：当前行的索引（从 0 开始）。</p>
</li>
<li><p>点击 “删除” 按钮时，会调用<code>handleDelete</code>方法并传入当前行数据（<code>scope.row</code>）</p>
</li>
</ul>
<h3 id="API-封装"><a href="#API-封装" class="headerlink" title="API 封装"></a>API 封装</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">deleteUser</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/deleteUser&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">mock</span>: <span class="literal">false</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在mock.js中</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="regexp">/api\/user\/deleteUser/</span>,<span class="string">&quot;post&quot;</span>,userApi.<span class="property">deleteUser</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="删除逻辑"><a href="#删除逻辑" class="headerlink" title="删除逻辑"></a>删除逻辑</h3><p>在 mockData 中的 user.js 上添加逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拦截删除请求并使用Mock处理</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="regexp">/api\/user\/deleteUser/</span>, <span class="string">&quot;post&quot;</span>, userApi.<span class="property">deleteUser</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除用户的具体处理逻辑</span></span><br><span class="line"><span class="attr">deleteUser</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 从请求体中解析出id</span></span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(config.<span class="property">body</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 验证参数</span></span><br><span class="line">  <span class="keyword">if</span> (!id) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">code</span>: -<span class="number">999</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;参数不正确&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 从用户列表中过滤掉要删除的用户（模拟数据库删除操作）</span></span><br><span class="line">    <span class="title class_">List</span> = <span class="title class_">List</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">u</span>) =&gt;</span> u.<span class="property">id</span> !== id);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;删除成功&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol>
<li>从请求体中解析出要删除的用户 ID（<code>id</code>）</li>
<li>验证 ID 是否存在：<ul>
<li>若不存在，返回错误信息（<code>code: -999</code>）</li>
<li>若存在，从用户列表（<code>List</code>）中删除该 ID 对应的用户（<code>filter</code>方法过滤掉该用户）</li>
</ul>
</li>
<li>返回删除成功的响应（<code>code: 200</code>）</li>
</ol>
<p>在 user.vue 组件中设置交互逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span>, <span class="title class_">ElMessageBox</span> &#125; <span class="keyword">from</span> <span class="string">&quot;element-plus&quot;</span>; <span class="comment">// 这里我们引入它们作为信息弹窗</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleDelete</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(<span class="string">&quot;此操作将永久删除该用户, 是否继续?&quot;</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">deleteUser</span>(&#123; <span class="attr">id</span>: data.<span class="property">id</span> &#125;);</span><br><span class="line">      <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;删除成功&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="title function_">getUserData</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;已取消删除&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们传入 id 便于进行 id 过滤逻辑</p>
<p>同时最后我们需要重新 getUserData 渲染一下以得到删除后的数据</p>
<h2 id="实现新增与编辑功能"><a href="#实现新增与编辑功能" class="headerlink" title="实现新增与编辑功能"></a>实现新增与编辑功能</h2><h3 id="总页面结构"><a href="#总页面结构" class="headerlink" title="总页面结构"></a>总页面结构</h3><p>对于新增功能 我们希望实现的功能是当我们点击新增按钮的时候出现一个表单用于添加信息 这些信息最终会被渲染到数据中</p>
<p>显然我们首先需要一个表单组件来作为新增（以及后面的编辑）操作的组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;dialogVisible&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:title</span>=<span class="string">&quot;action == &#x27;add&#x27; ? &#x27;新增用户&#x27; : &#x27;编辑用户&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">width</span>=<span class="string">&quot;35%&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:before-close</span>=<span class="string">&quot;handleClose&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--需要注意的是设置了:inline=&quot;true&quot;，</span></span><br><span class="line"><span class="comment">		会对el-select的样式造成影响，我们通过给他设置一个class=select-clearn</span></span><br><span class="line"><span class="comment">		在css进行处理--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:inline</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;formUser&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userForm&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;姓名&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formUser.name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入姓名&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;年龄&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;age&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model.number</span>=<span class="string">&quot;formUser.age&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入年龄&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">class</span>=<span class="string">&quot;select-clearn&quot;</span> <span class="attr">label</span>=<span class="string">&quot;性别&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;sex&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;formUser.sex&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;男&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;女&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;出生日期&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;birth&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-model</span>=<span class="string">&quot;formUser.birth&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;date&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">placeholder</span>=<span class="string">&quot;请输入&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;地址&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;addr&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formUser.addr&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入地址&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">style</span>=<span class="string">&quot;justify-content: flex-end&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleCancel&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSubmit&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="对话框部分"><a href="#对话框部分" class="headerlink" title="对话框部分"></a><strong>对话框部分</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog</span><br><span class="line">    v-model=<span class="string">&quot;dialogVisible&quot;</span></span><br><span class="line">    :title=<span class="string">&quot;action == &#x27;add&#x27; ? &#x27;新增用户&#x27; : &#x27;编辑用户&#x27;&quot;</span></span><br><span class="line">    width=<span class="string">&quot;35%&quot;</span></span><br><span class="line">    :before-close=<span class="string">&quot;handleClose&quot;</span></span><br><span class="line">  &gt;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><code>v-model=&quot;dialogVisible&quot;</code></p>
<ul>
<li><p>双向绑定一个布尔值变量 <code>dialogVisible</code>，用于控制对话框的显示与隐藏。</p>
</li>
<li><p>当 <code>dialogVisible</code> 为 <code>true</code> 时对话框显示，为 <code>false</code> 时隐藏。</p>
</li>
<li><pre><code class="js">const dialogVisible = ref(false);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">现在我们给 新增 or 编辑 or 取消 or 确定 button 对应的 click 事件里写上这个改变状态逻辑</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">dialogVisible.value = true;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p><code>:title=&quot;action == &#39;add&#39; ? &#39;新增用户&#39; : &#39;编辑用户&#39;&quot;</code></p>
<ul>
<li><p>通过动态绑定（<code>:</code> 是 <code>v-bind</code> 的简写）设置对话框标题。</p>
</li>
<li><p>使用三元表达式根据 action 变量的值动态切换标题：</p>
<ul>
<li><p>当 <code>action</code> 为 <code>&#39;add&#39;</code> 时，标题显示为 “新增用户”</p>
</li>
<li><p>其他情况（通常是 <code>&#39;edit&#39;</code>）时，标题显示为 “编辑用户”</p>
</li>
<li><pre><code class="js">const action = ref(&quot;add&quot;);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">       显然 对应地 我们需要在编辑 新增 按钮的点击事件中新增逻辑 来改变 action</span><br><span class="line"></span><br><span class="line">3. `width=&quot;35%&quot;`</span><br><span class="line"></span><br><span class="line">   - 设置对话框的宽度为页面宽度的 35%，也可以使用像素值（如 `width=&quot;500px&quot;`）。</span><br><span class="line"></span><br><span class="line">4. `:before-close=&quot;handleClose&quot;`</span><br><span class="line"></span><br><span class="line">   - 绑定对话框关闭前的回调函数 `handleClose`。</span><br><span class="line">   - 通常用于在关闭对话框前执行一些操作（如数据验证、确认提示等），若需要阻止关闭，可以在函数中返回 `false`。</span><br><span class="line"></span><br><span class="line">#### 新增（编辑）表单</span><br><span class="line"></span><br><span class="line">这里我们主要关注</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;el-form</span><br><span class="line">  :inline=&quot;true&quot;</span><br><span class="line">  :model=&quot;formUser&quot;</span><br><span class="line">  :rules=&quot;rules&quot;</span><br><span class="line">  ref=&quot;userForm&quot;</span><br><span class="line">&gt;&lt;/el-form&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong><code>:inline=&quot;true&quot;</code></strong><br>控制表单的布局方式：</p>
<ul>
<li><code>true</code>：表单元素将<strong>水平排列</strong>（ inline 模式），标签和输入框在同一行，节省垂直空间，适合搜索表单等场景。</li>
<li><code>false</code>（默认）：表单元素<strong>垂直排列</strong>，每个表单项单独占一行，适合复杂表单（如用户注册、信息编辑）。</li>
</ul>
</li>
<li><p><strong><code>:model=&quot;formUser&quot;</code></strong><br>绑定表单的数据对象，是表单的 “数据源”：</p>
<ul>
<li><code>formUser</code> 通常是一个响应式对象（如 <code>reactive</code> 或 <code>ref</code> 创建），存储表单中所有字段的值。</li>
<li>表单内的输入组件（如 <code>&lt;el-input&gt;</code>）会通过 <code>v-model</code> 与 <code>formUser</code> 的属性双向绑定。 这个双向绑定的数据可以供我们对其进行操作。</li>
<li><pre><code class="js">const formUser = reactive(&#123;&#125;);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- **`:rules=&quot;rules&quot;`**</span><br><span class="line"></span><br><span class="line">  绑定表单的校验规则，实现表单验证功能：</span><br><span class="line"></span><br><span class="line">  `rules` 是一个对象，定义了每个字段的校验规则（如必填、格式验证、长度限制等）。</span><br><span class="line"></span><br><span class="line">  当表单提交或输入变化时，Element UI 会自动根据 `rules` 校验 `formUser` 中的数据。</span><br><span class="line"></span><br><span class="line">  ```js</span><br><span class="line">  //表单校验规则</span><br><span class="line">  const rules = reactive(&#123;</span><br><span class="line">    name: [&#123; required: true, message: &quot;姓名是必填项&quot;, trigger: &quot;blur&quot; &#125;],</span><br><span class="line">    age: [</span><br><span class="line">      &#123; required: true, message: &quot;年龄是必填项&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">      &#123; type: &quot;number&quot;, message: &quot;年龄必须是数字&quot; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    sex: [&#123; required: true, message: &quot;性别是必选项&quot;, trigger: &quot;change&quot; &#125;],</span><br><span class="line">    birth: [&#123; required: true, message: &quot;出生日期是必选项&quot; &#125;],</span><br><span class="line">    addr: [&#123; required: true, message: &quot;地址是必填项&quot; &#125;],</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p><strong><code>ref=&quot;userForm&quot;</code></strong></p>
<p>给表单组件定义一个引用标识，用于在代码中直接操作表单：</p>
<p>通过 <code>ref</code> 可以调用表单的内置方法（如手动触发校验、重置表单等）。</p>
</li>
</ul>
<h3 id="对话框与表单事件"><a href="#对话框与表单事件" class="headerlink" title="对话框与表单事件"></a>对话框与表单事件</h3><p><strong>表单关闭与取消</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleClose</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">//获取表单重置表单</span></span><br><span class="line">  dialogVisible.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  proxy.<span class="property">$refs</span>[<span class="string">&quot;userForm&quot;</span>].<span class="title function_">resetFields</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleCancel</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  dialogVisible.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  proxy.<span class="property">$refs</span>[<span class="string">&quot;userForm&quot;</span>].<span class="title function_">resetFields</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>相同点是当我们取消或者关闭 表单消失之后我们都应该把原表单重置一下</p>
<h4 id="新增功能"><a href="#新增功能" class="headerlink" title="新增功能"></a>新增功能</h4><p>对于新增功能 我们需要将创建的这个 user 的数据最终渲染到数据中</p>
<p><strong>新增 API</strong></p>
<p>mockdata 部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 增加用户</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> name, addr, age, birth, sex</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type">&#123;code: number, data: &#123;message: string</span>&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="attr">createUser</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, addr, age, birth, sex &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(config.<span class="property">body</span>)</span><br><span class="line">    <span class="title class_">List</span>.<span class="title function_">unshift</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="title class_">Mock</span>.<span class="property">Random</span>.<span class="title function_">guid</span>(),</span><br><span class="line">        <span class="attr">name</span>: name,</span><br><span class="line">        <span class="attr">addr</span>: addr,</span><br><span class="line">        <span class="attr">age</span>: age,</span><br><span class="line">        <span class="attr">birth</span>: birth,</span><br><span class="line">        <span class="attr">sex</span>: sex</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;添加成功&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>api 与 mock 部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="title function_">addUser</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/user/addUser&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: params</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="regexp">/user\/addUser/</span>, <span class="string">&quot;post&quot;</span>, userApi.<span class="property">createUser</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面这一部分是模拟的后端逻辑 这里就不介绍了</p>
<p>首先我们给新增按钮绑定一个点击事件 handleclick</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleAdd</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  dialogVisible.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">  action.<span class="property">value</span> = <span class="string">&quot;add&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当我们填完数据点击确定后 需要上传这个数据 所以我们给确定按钮绑定一个点击事件 onSubmit</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onSubmit</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  proxy.<span class="property">$refs</span>[<span class="string">&quot;userForm&quot;</span>].<span class="title function_">validate</span>(<span class="title function_">async</span> (valid) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">      <span class="keyword">let</span> res = <span class="literal">null</span>;</span><br><span class="line">      formUser.<span class="property">birth</span> = <span class="title function_">timeFormat</span>(formUser.<span class="property">birth</span>);</span><br><span class="line">      <span class="keyword">if</span> (action.<span class="property">value</span> == <span class="string">&quot;add&quot;</span>) &#123;</span><br><span class="line">        res = <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">addUser</span>(formUser);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//这一段逻辑是用来处理编辑部分的</span></span><br><span class="line">      <span class="comment">// else &#123;</span></span><br><span class="line">      <span class="comment">// res = await proxy.$api.editUser(formUser)</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//&#125;</span></span><br><span class="line">      <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        dialogVisible.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        proxy.<span class="property">$refs</span>[<span class="string">&quot;userForm&quot;</span>].<span class="title function_">resetFields</span>();</span><br><span class="line">        <span class="title function_">getUserData</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;请填写正确的数据&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在 Element UI&#x2F;Element Plus 的表单组件（<code>&lt;el-form&gt;</code>）中，<code>validate</code> 是一个核心方法，用于触发表单的验证逻辑，检查表单字段是否符合预设的校验规则。 即去匹配规定的 rules 部分 会返回一个布尔值</p>
<p>其他的逻辑还是比较简单的 就不再赘述了</p>
<h4 id="编辑功能"><a href="#编辑功能" class="headerlink" title="编辑功能"></a>编辑功能</h4><p><strong>编辑 API</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改用户</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id, name, addr, age, birth, sex</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">&#123;code: number, data: &#123;message: string</span>&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">updateUser</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, name, addr, age, birth, sex &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(config.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">const</span> sex_num = <span class="built_in">parseInt</span>(sex);</span><br><span class="line">  <span class="title class_">List</span>.<span class="title function_">some</span>(<span class="function">(<span class="params">u</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (u.<span class="property">id</span> === id) &#123;</span><br><span class="line">      u.<span class="property">name</span> = name;</span><br><span class="line">      u.<span class="property">addr</span> = addr;</span><br><span class="line">      u.<span class="property">age</span> = age;</span><br><span class="line">      u.<span class="property">birth</span> = birth;</span><br><span class="line">      u.<span class="property">sex</span> = sex_num;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;编辑成功&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>模拟后端数据处理 其余部分跟新增功能很像 这里不再写</p>
<p><strong>页面部分</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> #=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit(scope.row)&quot;</span>&gt;</span></span><br><span class="line">    编辑</span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>删除&lt;/el-button</span><br><span class="line">  &gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>&lt;template #=&quot;scope&quot;&gt;</code>：这是 Vue 的具名插槽语法（<code>#</code> 是 <code>v-slot</code> 的简写），用于接收表格组件传递的当前行数据。</p>
<ul>
<li><code>scope</code> 是一个对象，包含了当前行的相关信息，其中 <code>scope.row</code> 表示当前行的数据对象（即表格中这一行对应的完整数据）。</li>
</ul>
<p>我们通过插槽把该行的数据对象拿到</p>
</li>
</ul>
<p>添加一个编辑点击事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleEdit</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">    action.<span class="property">value</span> = <span class="string">&#x27;edit&#x27;</span></span><br><span class="line"></span><br><span class="line">    dialogVisible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Object.assign(formUser, &#123; ...data, sex: &#x27;&#x27; + data.sex &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">     <span class="title class_">Object</span>.<span class="title function_">assign</span>(formUser, &#123;...data,<span class="attr">sex</span>:<span class="string">&#x27;&#x27;</span> + data.<span class="property">sex</span>&#125;)</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>将表格中选中的行数据（待编辑的数据）赋值给表单绑定的对象</strong>，从而实现编辑时的 “数据回显” 功能</p>
<p>可以看到这里我们引入了 nextTick 原因是我们在实际使用的过程中发现 当我们点击编辑 取消后再点击新增 原来编辑的用户数据会出现在新表单中 这实际上因为此时 DOM 还未更新 弹窗还没有完成初始化渲染 所以我们需要等待一下再替换数据</p>
<ul>
<li><strong>为什么需要 <code>nextTick</code>？</strong><br>这是解决 Vue 中 “DOM 更新时机” 问题的关键：<ul>
<li>当 <code>dialogVisible</code> 设为 <code>true</code> 时，弹窗组件开始渲染，但这个渲染过程是异步的（Vue 会将 DOM 更新操作放入队列，批量执行）。</li>
<li>如果直接在设置 <code>dialogVisible</code> 后立即填充数据，此时弹窗可能还未完成渲染，表单组件（如输入框、下拉框）尚未初始化。</li>
<li><code>nextTick</code> 会等待当前 DOM 更新循环完成后再执行回调函数，确保弹窗和表单组件已经渲染完毕，此时填充数据才能正确触发表单的双向绑定，实现数据回显。</li>
</ul>
</li>
</ul>
<p>简单说：<code>nextTick</code> 保证了数据填充操作是在弹窗和表单完全渲染后执行的，避免出现 “数据已更新但表单未显示” 的问题。</p>
<p>最后我们需要在确定键的 submit 中完善编辑的逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (action.<span class="property">value</span> == <span class="string">&quot;add&quot;</span>) &#123;</span><br><span class="line">  res = <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">addUser</span>(formUser);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  res = <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">editUser</span>(formUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现标签导航功能"><a href="#实现标签导航功能" class="headerlink" title="实现标签导航功能"></a>实现标签导航功能</h2><h3 id="pinia-实现状态管理"><a href="#pinia-实现状态管理" class="headerlink" title="pinia 实现状态管理"></a>pinia 实现状态管理</h3><p>标签上的内容我们需要根据左侧侧边栏的点击来传递状态 跨组件通信 我们需要使用 pinia 管理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; current &#125; <span class="keyword">from</span> <span class="string">&quot;hexo/dist/plugins/helper/is&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initState</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">isCollapse</span>: <span class="literal">false</span>, <span class="comment">//侧边栏是否收起</span></span><br><span class="line">    <span class="attr">tags</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">currentMenu</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useAllDataStore = <span class="title function_">defineStore</span>(<span class="string">&quot;allData&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//refstate属性</span></span><br><span class="line">  <span class="comment">//computed getters</span></span><br><span class="line">  <span class="comment">//function actions</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> state = <span class="title function_">ref</span>(<span class="title function_">initState</span>());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">selectMenu</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (val.<span class="property">name</span> === <span class="string">&quot;home&quot;</span>) &#123;</span><br><span class="line">      state.<span class="property">value</span>.<span class="property">currentMenu</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> index = state.<span class="property">value</span>.<span class="property">tags</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">name</span> === val.<span class="property">name</span>);</span><br><span class="line">      index === -<span class="number">1</span> ? state.<span class="property">value</span>.<span class="property">tags</span>.<span class="title function_">push</span>(val) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">undateTags</span>(<span class="params">tag</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> index = state.<span class="property">value</span>.<span class="property">tags</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">name</span> === tag.<span class="property">name</span>);</span><br><span class="line">    state.<span class="property">value</span>.<span class="property">tags</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    state,</span><br><span class="line">    selectMenu,</span><br><span class="line">    undateTags,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>我们新初始化了两个状态 分别是当前标签 tags 和 当前选择的菜单 currentMenu 并且返回了一个选择菜单和添加标签的方法</p>
<ol>
<li><p><strong>初始化状态（initState）</strong></p>
<ul>
<li><p>tags 数组：存储所有标签页数据，初始只包含「首页」标签</p>
<ul>
<li>每个标签包含 <code>path</code>（路由路径）、<code>name</code>（路由名称，唯一标识）、<code>label</code>（显示文本）、<code>icon</code>（图标）</li>
</ul>
</li>
<li><p><code>currentMenu</code>：记录当前选中的菜单（暂时未在标签功能中直接使用）</p>
</li>
<li><p><code>isCollapse</code>：侧边栏折叠状态（与标签功能无关）</p>
</li>
</ul>
</li>
<li><p><strong>核心方法</strong></p>
<ul>
<li><p>selectMenu(val)：添加标签或切换标签</p>
</li>
<li><pre><code class="js">function selectMenu(val) &#123;
  if (val.name === &quot;home&quot;) &#123;
    state.value.currentMenu = null;
  &#125; else &#123;
    let index = state.value.tags.findIndex(
      (item) =&gt; item.name === val.name
    );
    index === -1 ? state.value.tags.push(val) : &quot;&quot;;
  &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 如果是「首页」（`val.name === &#x27;home&#x27;`），不重复添加</span><br><span class="line">  - 非首页标签：先检查 `tags` 中是否已存在（通过 `findIndex` 判断），不存在则添加到 `tags` 数组</span><br><span class="line"></span><br><span class="line">- undateTags(tag)：删除标签</span><br><span class="line"></span><br><span class="line">- ```js</span><br><span class="line">  function undateTags(tag) &#123;</span><br><span class="line">    let index = state.value.tags.findIndex((item) =&gt; item.name === tag.name);</span><br><span class="line">    state.value.tags.splice(index, 1);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

- 找到要删除的标签索引（通过 `name` 匹配），使用 `splice` 从 `tags` 数组中移除
</code></pre>
</li>
</ul>
</li>
</ol>
<p><strong>这是标签导航功能的核心逻辑 负责管理标签数据的增删和状态维护</strong></p>
<h3 id="标签组件"><a href="#标签组件" class="headerlink" title="标签组件"></a>标签组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> &#123; useRoute,useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref,computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useAllDataStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ro &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus/es/locales.mjs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useAllDataStore</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tags = <span class="title function_">computed</span>(<span class="function">()=&gt;</span>store.<span class="property">state</span>.<span class="property">tags</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> route = <span class="title function_">useRoute</span>()</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleMenu</span> = (<span class="params">tag</span>) =&gt; &#123;</span><br><span class="line">    router.<span class="title function_">push</span>(tag.<span class="property">name</span>)</span><br><span class="line"></span><br><span class="line">    store.<span class="title function_">selectMenu</span>(tag)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleClose</span> = (<span class="params">tag,index</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//通过pinia管理</span></span><br><span class="line">    store.<span class="title function_">undateTags</span>(tag)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果点击关闭的tag不是当前页面的话</span></span><br><span class="line">    <span class="keyword">if</span>(tag.<span class="property">name</span> !== route.<span class="property">name</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index === store.<span class="property">state</span>.<span class="property">tags</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        store.<span class="title function_">selectMenu</span>(tags.<span class="property">value</span>[index - <span class="number">1</span>])</span><br><span class="line">        router.<span class="title function_">push</span>(tags.<span class="property">value</span>[index - <span class="number">1</span>].<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        store.<span class="title function_">selectMenu</span>(tags.<span class="property">value</span>[index])</span><br><span class="line">        router.<span class="title function_">push</span>(tags.<span class="property">value</span>[index].<span class="property">name</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tags&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-tag</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">v-for</span>=<span class="string">&quot;(tag,index) in tags&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:key</span>=<span class="string">&quot;tag.name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:closable</span>=<span class="string">&quot;tag.name !== &#x27;home&#x27;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:effect</span>=<span class="string">&quot;route.name===tag.name ? &#x27;dark&#x27;:&#x27;plain&#x27;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">@<span class="attr">click</span> = <span class="string">&quot;handleMenu(tag)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">@<span class="attr">close</span>=<span class="string">&quot;handleClose(tag,index)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; tag.label &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.tags</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.el-tag</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol>
<li><strong>数据关联</strong><ul>
<li>通过 <code>computed(() =&gt; store.state.tags)</code> 将 Pinia 中的 <code>tags</code> 数组映射为组件内的响应式数据，实现数据联动</li>
<li>使用 <code>route.name</code> 获取当前路由名称，用于判断哪个标签是「活跃状态」</li>
</ul>
</li>
<li><strong>标签渲染（template）</strong><ul>
<li>用 <code>v-for</code> 遍历 <code>tags</code> 数组，渲染 <code>el-tag</code> 组件</li>
<li><code>:closable=&quot;tag.name !== &#39;home&#39;&quot;</code>：首页标签不可关闭，其他标签可关闭</li>
<li><code>:effect</code>：根据当前路由是否与标签匹配，设置不同样式（<code>dark</code> 表示活跃，<code>plain</code> 表示非活跃）</li>
</ul>
</li>
<li><strong>交互逻辑</strong><ul>
<li>handleMenu(tag)：点击标签时触发<ul>
<li>调用 <code>router.push(tag.name)</code> 跳转到对应路由</li>
<li>调用 <code>store.selectMenu(tag)</code> 同步标签状态（如果是新标签则添加）</li>
</ul>
</li>
<li>handleClose(tag, index)：关闭标签时触发<ul>
<li>调用 <code>store.undateTags(tag)</code> 从仓库中删除标签</li>
<li>如果关闭的是「当前活跃标签」，需要自动切换到其他标签：<ul>
<li>若删除的是最后一个标签，切换到前一个标签</li>
<li>否则切换到当前索引位置的下一个标签</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="标签和路由之间的关系"><a href="#标签和路由之间的关系" class="headerlink" title="标签和路由之间的关系"></a>标签和路由之间的关系</h3><p>标签（Tags）和路由（Router）是这个导航功能中<strong>紧密关联、相互配合</strong>的两个核心部分，它们的关系可以概括为：<strong>标签是路由的 “可视化表现”，路由是标签的 “跳转目标”</strong>。具体来说，它们通过 “路由名称（<code>name</code>）” 实现双向绑定，协同完成页面导航功能。</p>
<p>标签和路由的关联基于一个关键字段 ——<strong>路由名称（<code>name</code>）</strong>，这是两者建立联系的 “唯一标识”。</p>
<p>在路由配置中，每个路由都会有一个唯一的 <code>name</code>，例如：</p>
<p>标签（<code>tags</code> 数组中的元素）的结构与路由一一对应，其中 <code>name</code> 字段直接对应路由的 <code>name</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标签数据结构（与路由的name绑定）</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>,    <span class="comment">// 对应路由的path</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;user&#x27;</span>,     <span class="comment">// 对应路由的name（关键关联）</span></span><br><span class="line">  <span class="attr">label</span>: <span class="string">&#x27;用户管理&#x27;</span>, <span class="comment">// 来自路由的meta.label</span></span><br><span class="line">  <span class="attr">icon</span>: <span class="string">&#x27;user&#x27;</span>      <span class="comment">// 来自路由的meta.icon</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结论</strong>：<code>name</code> 是标签和路由的 “桥梁”，通过它可以明确 “哪个标签对应哪个路由”。</p>
<p>标签和路由的联动体现在用户操作的全流程中，相互触发、相互同步：</p>
<ul>
<li><p>当用户点击左侧菜单（如 “用户管理”）时：</p>
<ol>
<li>菜单组件会将路由信息（包含 <code>name</code>、<code>path</code>、<code>label</code> 等）传递给 Pinia 的 <code>selectMenu</code> 方法。</li>
<li><code>selectMenu</code> 方法检查该 <code>name</code> 对应的标签是否已存在，不存在则添加到 <code>tags</code> 数组（生成新标签）。</li>
<li>同时，路由系统会通过 <code>router.push(menu.name)</code> 跳转到对应的路由页面。</li>
</ol>
<p><strong>结果</strong>：标签栏新增标签，页面跳转到对应路由，两者同步更新。</p>
</li>
<li><p>当用户点击标签栏中的某个标签（如 “用户管理” 标签）时：</p>
<ol>
<li>标签组件的 <code>handleMenu</code> 方法被触发，获取该标签的 <code>name</code>（如 <code>user</code>）。</li>
<li>调用 <code>router.push(tag.name)</code>，路由系统跳转到 <code>name</code> 为 <code>user</code> 的路由页面。</li>
<li>路由跳转后，<code>route.name</code> 会更新为当前路由的 <code>name</code>，标签组件通过 <code>route.name === tag.name</code> 判断哪个标签为 “活跃状态”，并高亮显示。</li>
</ol>
<p><strong>结果</strong>：标签点击触发路由跳转，路由状态反作用于标签的显示样式。</p>
</li>
</ul>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><ul>
<li><p>当用户关闭某个标签（如 “用户管理”）时：</p>
<ol>
<li>如果关闭的是 “当前活跃标签”（即标签的 <code>name</code> 等于 <code>route.name</code>），则需要自动切换到其他标签。</li>
<li>标签组件会根据剩余标签的索引，调用 <code>router.push(其他标签的name)</code>，跳转到对应的路由页面。</li>
<li>路由跳转后，<code>route.name</code> 更新，标签的活跃状态也随之更新。</li>
</ol>
<p><strong>结果</strong>：标签删除后，路由自动切换到合理的页面，避免页面空白。</p>
</li>
</ul>
<h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><ul>
<li><p>如果用户不通过标签，而是直接修改浏览器 URL（如输入 <code>/user</code>），路由系统会触发跳转：</p>
<ol>
<li>路由跳转后，<code>route.name</code> 变为 <code>user</code>。</li>
<li>此时左侧菜单或其他组件可以监听路由变化（通过 <code>watch(route, ...)</code>），调用 <code>selectMenu</code> 方法。</li>
<li><code>selectMenu</code> 方法会自动添加 <code>name</code> 为 <code>user</code> 的标签（如果不存在）。</li>
</ol>
<p><strong>结果</strong>：路由变化会自动同步到标签栏，确保标签与当前页面一致。</p>
</li>
</ul>
<h2 id="实现面包屑功能"><a href="#实现面包屑功能" class="headerlink" title="实现面包屑功能"></a>实现面包屑功能</h2><h3 id="页面结构-3"><a href="#页面结构-3" class="headerlink" title="页面结构"></a>页面结构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-breadcrumb-item :to=<span class="string">&quot;&#123; path: &#x27;/&#x27; &#125;&quot;</span>&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-breadcrumb-item</span> <span class="attr">v-if</span>=<span class="string">&quot;current&quot;</span> <span class="attr">:to</span>=<span class="string">&quot;current.path&quot;</span>&gt;</span>&#123;&#123; current.label &#125;&#125;<span class="tag">&lt;/<span class="name">el-breadcrumb-item</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>现在我们需要传入当前的菜单 故而需要跨组件通信 使用 pinia 储存</p>
<h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><p>对于当前的菜单 我们还是使用之前实现标签导航功能的方法 记录一下选择菜单即可</p>
<p>在 store 中 首先我们在 initState 中定义一个 currentMenu 这里就不写了</p>
<p>在 selectMenu 方法中 更新一下这个数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">selectMenu</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (val.<span class="property">name</span> === <span class="string">&quot;home&quot;</span>) &#123;</span><br><span class="line">    state.<span class="property">value</span>.<span class="property">currentMenu</span> = <span class="literal">null</span>; <span class="comment">// 不用加到面包屑</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    state.<span class="property">value</span>.<span class="property">currentMenu</span> = val; <span class="comment">// 更新一下</span></span><br><span class="line">    <span class="keyword">let</span> index = state.<span class="property">value</span>.<span class="property">tags</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">name</span> === val.<span class="property">name</span>);</span><br><span class="line">    index === -<span class="number">1</span> ? state.<span class="property">value</span>.<span class="property">tags</span>.<span class="title function_">push</span>(val) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后我们需要在 commonHeader 中 将 current 改成响应式依赖的数据即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> current = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> store.<span class="property">state</span>.<span class="property">currentMenu</span>);</span><br></pre></td></tr></table></figure>

<h2 id="实现登录功能"><a href="#实现登录功能" class="headerlink" title="实现登录功能"></a>实现登录功能</h2><h3 id="登录页面的静态结构搭建"><a href="#登录页面的静态结构搭建" class="headerlink" title="登录页面的静态结构搭建"></a>登录页面的静态结构搭建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;body-login&quot;&gt;</span><br><span class="line">    &lt;el-form :model=&quot;loginForm&quot; class=&quot;login-container&quot;&gt;</span><br><span class="line">      &lt;h1&gt;欢迎登录&lt;/h1&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">          type=&quot;input&quot;</span><br><span class="line">          placeholder=&quot;请输入账号&quot;</span><br><span class="line">          v-model=&quot;loginForm.username&quot;</span><br><span class="line">        &gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">          type=&quot;password&quot;</span><br><span class="line">          placeholder=&quot;请输入密码&quot;</span><br><span class="line">          v-model=&quot;loginForm.password&quot;</span><br><span class="line">        &gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;handleLogin&quot;&gt;登录&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;less&quot;&gt;</span><br><span class="line">.body-login &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background-image: url(&quot;../assets/images/background.png&quot;);</span><br><span class="line">  background-size: 100%;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.login-container &#123;</span><br><span class="line">  width: 350px;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  border: ipx solid #eaeaea;</span><br><span class="line">  border-radius: 15px;</span><br><span class="line">  padding: 35px 35px 15px 35px;</span><br><span class="line"></span><br><span class="line">  box-shadow: 0 0 25px #cacaca;</span><br><span class="line">  margin: 250px auto;</span><br><span class="line">  h1 &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">    color: #504550;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">:deep(.el-form-item__content) &#123;</span><br><span class="line">  justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>这里我们双向绑定一个 loginForm 作为响应式的登录表单对象，用于绑定页面上的用户名和密码输入框</p>
<p>在实际开发中 当我们接受到输入的内容之后会发送网络请求让后端做账号密码的判断 当然这里我们是用 mock 数据模拟的 写在这里便于我们理解整个登录功能的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Mock</span> <span class="keyword">from</span> <span class="string">&quot;mockjs&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">getMenu</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(config.<span class="property">body</span>);</span><br><span class="line">    <span class="comment">// 先判断用户是否存在</span></span><br><span class="line">    <span class="comment">// 判断账号和密码是否对应</span></span><br><span class="line">    <span class="comment">//menuList用于后面做权限分配，也就是用户可以展示的菜单</span></span><br><span class="line">    <span class="keyword">if</span> (username === <span class="string">&quot;admin&quot;</span> &amp;&amp; password === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          <span class="attr">menuList</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">              <span class="attr">label</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&quot;house&quot;</span>,</span><br><span class="line">              <span class="attr">url</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">path</span>: <span class="string">&quot;/mall&quot;</span>,</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;mall&quot;</span>,</span><br><span class="line">              <span class="attr">label</span>: <span class="string">&quot;商品管理&quot;</span>,</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&quot;video-play&quot;</span>,</span><br><span class="line">              <span class="attr">url</span>: <span class="string">&quot;Mall&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">path</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">              <span class="attr">label</span>: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">              <span class="attr">url</span>: <span class="string">&quot;User&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">path</span>: <span class="string">&quot;other&quot;</span>,</span><br><span class="line">              <span class="attr">label</span>: <span class="string">&quot;其他&quot;</span>,</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&quot;location&quot;</span>,</span><br><span class="line">              <span class="attr">children</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">path</span>: <span class="string">&quot;/page1&quot;</span>,</span><br><span class="line">                  <span class="attr">name</span>: <span class="string">&quot;page1&quot;</span>,</span><br><span class="line">                  <span class="attr">label</span>: <span class="string">&quot;页面1&quot;</span>,</span><br><span class="line">                  <span class="attr">icon</span>: <span class="string">&quot;setting&quot;</span>,</span><br><span class="line">                  <span class="attr">url</span>: <span class="string">&quot;Page1&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">path</span>: <span class="string">&quot;/page2&quot;</span>,</span><br><span class="line">                  <span class="attr">name</span>: <span class="string">&quot;page2&quot;</span>,</span><br><span class="line">                  <span class="attr">label</span>: <span class="string">&quot;页面2&quot;</span>,</span><br><span class="line">                  <span class="attr">icon</span>: <span class="string">&quot;setting&quot;</span>,</span><br><span class="line">                  <span class="attr">url</span>: <span class="string">&quot;Page2&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">token</span>: <span class="title class_">Mock</span>.<span class="property">Random</span>.<span class="title function_">guid</span>(),</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;获取成功&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (username === <span class="string">&quot;xiaoxiao&quot;</span> &amp;&amp; password === <span class="string">&quot;xiaoxiao&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          <span class="attr">menuList</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">              <span class="attr">label</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&quot;house&quot;</span>,</span><br><span class="line">              <span class="attr">url</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">path</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">              <span class="attr">label</span>: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">              <span class="attr">icon</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">              <span class="attr">url</span>: <span class="string">&quot;User&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">token</span>: <span class="title class_">Mock</span>.<span class="property">Random</span>.<span class="title function_">guid</span>(),</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;获取成功&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">code</span>: -<span class="number">999</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;密码错误&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们登录后想要做的事是</p>
<p>1.跳转到 home 页面</p>
<p>2.这个 home 页面的左侧菜单数据需要跟登录的用户一一对应</p>
<p>也就是说 当我们拿到后端放回的用户字段后 需要传递到左侧菜单中实现对应 跨组件通信故而我们需要使用 pinia</p>
<h3 id="pinia-传递数据实现对应"><a href="#pinia-传递数据实现对应" class="headerlink" title="pinia 传递数据实现对应"></a>pinia 传递数据实现对应</h3><p>看 mock 数据可以看出来传递了 menulist 和 token 两个字段 我们把这些定义到 store 中实现跨组件通信</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initState</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">isCollapse</span>: <span class="literal">false</span>, <span class="comment">//侧边栏是否收起</span></span><br><span class="line">    <span class="attr">tags</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">currentMenu</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">menuList</span>: [],</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">routeList</span>: [],</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在 useAllData 里添加一个方法用来实现 menulist 的更新渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateMenuList</span>(<span class="params">menu</span>) &#123;</span><br><span class="line">  state.<span class="property">value</span>.<span class="property">menuList</span> = menu;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们在 login.vue 的登录方法中添加这个逻辑</p>
<p>同时我们顺便实现一下登录成功后跳转到 home 页面的逻辑 这里是直接用 router.push 实现的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleLogin</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">getMenu</span>(loginForm);</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="comment">//拿到菜单以后</span></span><br><span class="line">    <span class="comment">//把得到的用户字段传递到store中</span></span><br><span class="line">    store.<span class="title function_">updateMenuList</span>(res.<span class="property">menuList</span>);</span><br><span class="line">    store.<span class="property">state</span>.<span class="property">token</span> = res.<span class="property">token</span>;</span><br><span class="line">    <span class="comment">//通过push方法实现页面跳转</span></span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&quot;/home&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>最后，我们只需要将左侧菜单栏的数据替换成动态数据即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useAllDataStore</span>();</span><br><span class="line"><span class="keyword">const</span> list = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> store.<span class="property">state</span>.<span class="property">menuList</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里我们用 computed 来实现响应式依赖</p>
<h2 id="实现动态路由进行路由鉴权"><a href="#实现动态路由进行路由鉴权" class="headerlink" title="实现动态路由进行路由鉴权"></a>实现动态路由进行路由鉴权</h2><p>主要是用来处理多账号（权限不同）登录的路由问题</p>
<p>动态路由介绍：<a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/guide/advanced/dynamic-routing.html#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1">https://router.vuejs.org/zh/guide/advanced/dynamic-routing.html#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1</a></p>
<p>主要实现了基于后端返回菜单列表（账号权限不同 菜单列表也不同）的动态路由添加功能</p>
<p>实际上和路由守卫比较像 都是防止访问到无权限访问到的地方</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addMenu</span>(<span class="params">router, type</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> menu = state.<span class="property">value</span>.<span class="property">menuList</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">glob</span>(<span class="string">&quot;../views/**/*.vue&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> routeArr = [];</span><br><span class="line">  menu.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">children</span>) &#123;</span><br><span class="line">      item.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> url = <span class="string">`../views/<span class="subst">$&#123;val.url&#125;</span>.vue`</span>;</span><br><span class="line">        val.<span class="property">component</span> = <span class="variable language_">module</span>[url];</span><br><span class="line">        routeArr.<span class="title function_">push</span>(...item.<span class="property">children</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> url = <span class="string">`../views/<span class="subst">$&#123;item.url&#125;</span>.vue`</span>;</span><br><span class="line">      item.<span class="property">component</span> = <span class="variable language_">module</span>[url];</span><br><span class="line">      routeArr.<span class="title function_">push</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  state.<span class="property">value</span>.<span class="property">routeList</span> = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> routers = router.<span class="title function_">getRoutes</span>();</span><br><span class="line"></span><br><span class="line">  routers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">name</span> === <span class="string">&quot;main&quot;</span> || item.<span class="property">name</span> === <span class="string">&quot;login&quot;</span> || item.<span class="property">name</span> === <span class="string">&quot;404&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      router.<span class="title function_">removeRoute</span>(item.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  routeArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">value</span>.<span class="property">routeList</span>.<span class="title function_">push</span>(router.<span class="title function_">addRoute</span>(<span class="string">&quot;main&quot;</span>, item));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们分段解释一下每一个部分实现的功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const menu = state.value.menuList;</span><br><span class="line">const module = import.meta.glob(&#x27;../views/**/*.vue&#x27;)</span><br><span class="line">const routeArr = [];</span><br></pre></td></tr></table></figure>

<p>需要传入 router 对象进来</p>
<p>menu 返回后端判断完用户权限后返回的菜单列表</p>
<p>module 使用的是 vite 的动态导入 Vite 支持使用特殊的 <code>import.meta.glob</code> 函数从文件系统导入多个模块</p>
<p>routeArr 是格式化后的路由数组 也就是我们后面添加的路由部分</p>
<h3 id="格式化后端数据为前端配置"><a href="#格式化后端数据为前端配置" class="headerlink" title="格式化后端数据为前端配置"></a>格式化后端数据为前端配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//格式化菜单路由</span></span><br><span class="line">menu.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//如果菜单有children</span></span><br><span class="line">    <span class="keyword">if</span>(item.<span class="property">children</span>)&#123;</span><br><span class="line">        <span class="comment">//把children遍历格式化</span></span><br><span class="line">        item.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> url=<span class="string">`../views/<span class="subst">$&#123;val.url&#125;</span>.vue`</span></span><br><span class="line">            <span class="comment">//这里通过url取出对应的组件</span></span><br><span class="line">            val.<span class="property">component</span>=<span class="variable language_">module</span>[url]</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//需要注意的是我们只需要为item.children中的菜单添加路由，所以我们把它解构出来</span></span><br><span class="line">        routeArr.<span class="title function_">push</span>(...item.<span class="property">children</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> url=<span class="string">`../views/<span class="subst">$&#123;item.url&#125;</span>.vue`</span></span><br><span class="line">        item.<span class="property">component</span>=<span class="variable language_">module</span>[url]</span><br><span class="line">        routeArr.<span class="title function_">push</span>(item)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这段代码的核心功能是<strong>将后端返回的菜单数据格式化为前端路由所需的配置结构</strong>，主要处理了菜单与组件的映射关系，并构建可直接用于路由注册的数组。以下是详细解释：</p>
<p>遍历后端返回的原始菜单列表（<code>menu</code>），根据菜单是否包含子菜单（<code>children</code>）进行不同处理，最终生成符合前端路由规范的配置数组（<code>routeArr</code>）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历原始菜单列表中的每个菜单项</span></span><br><span class="line">menu.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>menu</code> 通常是后端返回的原始菜单数据，包含路由路径、菜单名称等信息</li>
<li><code>forEach</code> 循环逐个处理每个菜单项</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断当前菜单项是否包含子菜单</span></span><br><span class="line"><span class="keyword">if</span>(item.<span class="property">children</span>)&#123;</span><br></pre></td></tr></table></figure>

<ul>
<li>检查当前菜单项是否有 <code>children</code> 属性（即是否为包含子菜单的父级菜单）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历子菜单，为每个子菜单配置组件</span></span><br><span class="line">item.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="string">`../views/<span class="subst">$&#123;val.url&#125;</span>.vue`</span>;</span><br><span class="line">  <span class="comment">// 通过url路径从导入的组件集合中匹配对应的组件</span></span><br><span class="line">  val.<span class="property">component</span> = <span class="variable language_">module</span>[url];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>若有子菜单，遍历每个子菜单（<code>val</code>）</li>
<li>拼接组件路径：<code>val.url</code> 是后端返回的路由标识（如 “dashboard&#x2F;index”），拼接后得到完整的组件路径（如 “..&#x2F;views&#x2F;dashboard&#x2F;index.vue”）</li>
<li>绑定组件：<code>module</code> 是通过 <code>import.meta.glob</code> 导入的所有组件集合，通过拼接的 <code>url</code> 找到对应的组件并赋值给 <code>val.component</code>，<code>component</code> 是 Vue Router 路由配置中<strong>必须的属性</strong>，用于指定当前路由对应的页面组件，完成路由与组件的映射</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 将处理好的子菜单解构添加到路由数组（只保留子菜单作为可访问路由）</span></span><br><span class="line">    routeArr.<span class="title function_">push</span>(...item.<span class="property">children</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>父级菜单通常只是分组作用，实际可访问的路由是子菜单，因此将处理好的子菜单（<code>item.children</code>）添加到 <code>routeArr</code></li>
<li>使用扩展运算符（<code>...</code>）是为了将子菜单数组展开，避免形成嵌套数组</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 无子菜单的情况，直接为当前菜单项配置组件</span></span><br><span class="line">    <span class="keyword">let</span> url=<span class="string">`../views/<span class="subst">$&#123;item.url&#125;</span>.vue`</span></span><br><span class="line">    item.<span class="property">component</span>=<span class="variable language_">module</span>[url]</span><br><span class="line">    <span class="comment">// 将处理好的菜单项添加到路由数组</span></span><br><span class="line">    routeArr.<span class="title function_">push</span>(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>若当前菜单项没有子菜单，直接处理该菜单项本身</p>
</li>
<li><p>同样拼接组件路径并绑定组件，然后将其添加到 <code>routeArr</code></p>
</li>
<li><p><strong>组件映射</strong>：通过后端返回的 <code>url</code> 标识，精准匹配到前端对应的 Vue 组件</p>
</li>
<li><p><strong>路由格式化</strong>：将原始菜单数据转换为符合 Vue Router 要求的结构（包含 <code>component</code> 等关键属性）</p>
</li>
<li><p><strong>层级处理</strong>：区分父子菜单，只将实际可访问的子菜单（或无子菜单的菜单项）加入路由数组</p>
</li>
</ul>
<p>处理完成后，<code>routeArr</code> 就包含了所有可直接用于 <code>router.addRoute()</code> 的路由配置对象，为后续动态添加路由奠定了基础。</p>
<h3 id="路由的清理和重新添加"><a href="#路由的清理和重新添加" class="headerlink" title="路由的清理和重新添加"></a>路由的清理和重新添加</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">state.<span class="property">value</span>.<span class="property">routeList</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> routers = router.<span class="title function_">getRoutes</span>();</span><br><span class="line"></span><br><span class="line">routers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (item.<span class="property">name</span> === <span class="string">&quot;main&quot;</span> || item.<span class="property">name</span> === <span class="string">&quot;login&quot;</span> || item.<span class="property">name</span> === <span class="string">&quot;404&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    router.<span class="title function_">removeRoute</span>(item.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">routeArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  state.<span class="property">value</span>.<span class="property">routeList</span>.<span class="title function_">push</span>(router.<span class="title function_">addRoute</span>(<span class="string">&quot;main&quot;</span>, item));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这段代码主要实现了<strong>路由的清理与重新添加</strong>，是动态路由管理的核心步骤，确保路由状态与当前用户权限保持一致。以下是详细解析：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state.<span class="property">value</span>.<span class="property">routeList</span> = [];</span><br></pre></td></tr></table></figure>

<ul>
<li>清空存储路由记录的数组（<code>routeList</code>），为后续存储新路由做准备</li>
</ul>
<p><strong>获取并清理现有路由</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> routers = router.<span class="title function_">getRoutes</span>(); <span class="comment">// 获取当前所有已注册的路由</span></span><br><span class="line"></span><br><span class="line">routers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 保留基础路由（main框架页、login登录页、404页面）</span></span><br><span class="line">  <span class="keyword">if</span> (item.<span class="property">name</span> === <span class="string">&quot;main&quot;</span> || item.<span class="property">name</span> === <span class="string">&quot;login&quot;</span> || item.<span class="property">name</span> === <span class="string">&quot;404&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 移除其他所有动态添加的路由</span></span><br><span class="line">    router.<span class="title function_">removeRoute</span>(item.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>获取现有路由</strong>：<code>router.getRoutes()</code> 方法获取当前路由实例中所有已注册的路由配置</p>
</li>
<li><p>路由过滤规则：</p>
<ul>
<li>保留 <code>main</code>（通常是嵌套路由的父容器）、<code>login</code>（登录页）、<code>404</code>（NotFound 页面）这三个核心路由</li>
<li>移除其他所有动态生成的路由（这些路由通常是基于用户权限动态添加的）</li>
</ul>
</li>
<li><p><strong>清理目的</strong>：避免路由重复注册，或用户权限变更后仍能访问旧路由（比如退出登录后切换用户）</p>
<p><strong>动态添加新路由</strong></p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">routeArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 向&quot;main&quot;路由下添加子路由，并将添加结果存入routeList</span></span><br><span class="line">  state.<span class="property">value</span>.<span class="property">routeList</span>.<span class="title function_">push</span>(router.<span class="title function_">addRoute</span>(<span class="string">&quot;main&quot;</span>, item));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>添加子路由：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.addRoute(&quot;main&quot;, item)</span><br></pre></td></tr></table></figure>

<p>表示将处理好的路由配置（item）作为子路由添加到 name 为 “main” 的父路由下</p>
<ul>
<li>这意味着所有动态路由都会嵌套在<code>main</code>路由对应的页面中（通常是包含侧边栏、导航栏的布局页）</li>
</ul>
</li>
<li><p><strong>记录路由</strong>：<code>router.addRoute</code> 会返回一个用于移除该路由的函数，将其存入<code>routeList</code>，方便后续可能的路由管理（如需要单独移除某条路由）</p>
</li>
</ul>
<ol>
<li><strong>路由重置</strong>：先清除旧的动态路由，避免权限变更后出现路由混乱</li>
<li><strong>权限生效</strong>：将基于最新权限生成的路由（<code>routeArr</code>）重新添加到路由系统</li>
<li><strong>状态同步</strong>：通过<code>routeList</code>记录当前有效的动态路由，保持响应式状态与实际路由一致</li>
</ol>
<p>这一步完成后，前端路由就会与后端返回的菜单权限完全匹配，实现 “用户只能访问其权限范围内的页面” 的控制目标。</p>
<h3 id="登录调用方法实现动态路由"><a href="#登录调用方法实现动态路由" class="headerlink" title="登录调用方法实现动态路由"></a>登录调用方法实现动态路由</h3><p>接下来我们只需要在登录按钮的逻辑里调用一下这个方法就可以实现动态路由进一步实现根据用户权限进行路由鉴权了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleLogin</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> proxy.<span class="property">$api</span>.<span class="title function_">getMenu</span>(loginForm);</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="comment">//拿到菜单以后 在哪里显示</span></span><br><span class="line">    store.<span class="title function_">updateMenuList</span>(res.<span class="property">menuList</span>);</span><br><span class="line">    store.<span class="property">state</span>.<span class="property">token</span> = res.<span class="property">token</span>;</span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&quot;/home&quot;</span>);</span><br><span class="line">    store.<span class="title function_">addMenu</span>(router);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>实现动态路由后 我们再把原先在路由中写死的子路由路径给删掉 保证路由路径是根据用户权限动态实现的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//制定路由规则</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;main&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Main</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;login&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;@/views/Login.vue&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/404&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;404&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;@/views/404.vue&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="实现持久化储存-pinia-数据"><a href="#实现持久化储存-pinia-数据" class="headerlink" title="实现持久化储存 pinia 数据"></a>实现持久化储存 pinia 数据</h2><p>目的是 <strong>解决刷新后路由不存在的问题</strong></p>
<p>通过 <strong>Vue 的响应式监听 + localStorage 持久化</strong> 实现了状态的持久化存储，核心逻辑是将用户状态在变化时自动保存到本地，并在页面刷新时重新读取恢复。</p>
<h3 id="监听状态变化表并保存到-localStorage"><a href="#监听状态变化表并保存到-localStorage" class="headerlink" title="监听状态变化表并保存到 localStorage"></a>监听状态变化表并保存到 localStorage</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用watch监听state的变化</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  state,</span><br><span class="line">  <span class="function">(<span class="params">newObj</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果token不存在（如用户退出登录），不保存状态</span></span><br><span class="line">    <span class="keyword">if</span> (!newObj.<span class="property">token</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将最新的state转换为JSON字符串，存入localStorage</span></span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;store&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(newObj));</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">); <span class="comment">// 开启深度监听，确保嵌套对象变化也能被捕获</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>watch(state, ...)</code>：监听响应式状态<code>state</code>的所有变化（包括嵌套属性）</li>
<li>当 state 变化时，先判断 token 是否存在：<ul>
<li>若<code>token</code>不存在（通常是用户退出登录），则不保存状态（避免存储无效的登录状态）</li>
<li>若<code>token</code>存在（用户已登录），则通过<code>localStorage.setItem</code>将<code>state</code>以 JSON 字符串形式保存</li>
</ul>
</li>
<li><code>&#123; deep: true &#125;</code>：因为<code>state</code>可能是嵌套对象（如包含<code>menuList</code>、<code>routeList</code>等属性），开启深度监听才能捕获到深层属性的变化</li>
</ul>
<h3 id="页面刷新时重新读取-localStorage"><a href="#页面刷新时重新读取-localStorage" class="headerlink" title="页面刷新时重新读取 localStorage"></a>页面刷新时重新读取 localStorage</h3><p>在<strong>addMenu 方法</strong>中，通过<code>type === &quot;refresh&quot;</code>判断是否为页面刷新场景：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (type === <span class="string">&quot;refresh&quot;</span>) &#123;</span><br><span class="line">  <span class="comment">// 检查localStorage中是否有保存的状态</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;store&quot;</span>))) &#123;</span><br><span class="line">    <span class="comment">// 将本地存储的状态恢复到响应式state中</span></span><br><span class="line">    state.<span class="property">value</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;store&quot;</span>));</span><br><span class="line">    <span class="comment">// 重置routeList（因为它存储的是路由操作函数，无法被JSON序列化）</span></span><br><span class="line">    state.<span class="property">value</span>.<span class="property">routeList</span> = [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 若本地无数据（如首次访问），直接返回</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>作用</strong>：</p>
<ul>
<li>当页面刷新时（通常在<code>main.js</code>中调用<code>addMenu(router, &quot;refresh&quot;)</code>），从<code>localStorage</code>读取之前保存的状态</li>
<li>恢复到<code>state.value</code>中，保证刷新后用户的登录状态、菜单权限等数据不丢失</li>
<li>单独重置<code>routeList</code>是因为它存储的是<code>router.addRoute</code>返回的函数，这类函数无法被<code>JSON.stringify</code>序列化（会变成<code>null</code>），因此需要重新初始化</li>
</ul>
<h3 id="全局启动状态持久化"><a href="#全局启动状态持久化" class="headerlink" title="全局启动状态持久化"></a>全局启动状态持久化</h3><p>确保 “状态持久化” 在整个应用启动的 “最早阶段” 生效，避免出现 “状态丢失” 或 “功能异常” 所以我们必须在 vue 入口文件 <strong>main.js</strong>中调用</p>
<p>需要额外提的一点是，上述代码只是做了一个监听，实则保存刷新后路由的主要逻辑还是放在 addMenu 中的 所以我们最后调用这个方法的时候还是应该调用 addMenu</p>
<p><strong>在 main.js 中</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useAllDataStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores&quot;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个动态路由的方法必须要在use(pinia)之后使用，因为这样才可以获取到pinia对象</span></span><br><span class="line"><span class="comment">//必须在use(router)之前使用，因为如果是刷新，use(router)后执行完会直接跳转路由，所以需要在他之前执行动态路由方法</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useAllDataStore</span>();</span><br><span class="line">store.<span class="title function_">addMenu</span>(router, <span class="string">&quot;refresh&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<ol>
<li><strong>保存</strong>：用户操作导致<code>state</code>变化（如登录成功、权限变更）→ <code>watch</code>监听到变化 → 自动将<code>state</code>存入<code>localStorage</code></li>
<li><strong>恢复</strong>：页面刷新 → 调用<code>addMenu(router, &quot;refresh&quot;)</code> → 从<code>localStorage</code>读取数据 → 恢复到<code>state</code>中</li>
<li><strong>边界处理</strong>：用户退出登录时<code>token</code>被清除 → 不保存状态，避免无效数据残留</li>
</ol>
<p>这种方式通过<strong>监听状态变化自动持久化</strong>和<strong>刷新时主动恢复</strong>的组合，实现了状态的本地持久化，确保用户在页面刷新后仍能保持登录状态和对应的权限路由配置。核心依赖<code>localStorage</code>的持久化特性（除非手动清除，否则数据一直存在）和 Vue 的响应式监听能力。</p>
<h2 id="实现路由守卫"><a href="#实现路由守卫" class="headerlink" title="实现路由守卫"></a>实现路由守卫</h2><p>路由守卫官网 <a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB">导航守卫 | Vue Router</a></p>
<p>更具体的用法参考官网文档</p>
<p>路由守卫的核心目标是<strong>保障路由访问的合法性与页面逻辑的连贯性</strong>，具体场景包括：</p>
<ol>
<li><strong>权限控制</strong>：拦截未登录用户访问需授权页面（如个人中心、订单页），自动跳转至登录页。</li>
<li><strong>数据预处理</strong>：进入页面前置加载必要数据（如商品详情页加载商品信息），避免页面 “空白等待”。</li>
<li><strong>导航拦截</strong>：阻止用户误操作离开未保存的表单页面（如编辑文档时点击后退，弹出 “是否放弃修改” 提示）。</li>
<li><strong>日志 &#x2F; 埋点</strong>：记录用户路由跳转行为（如统计 “首页 → 商品页” 的转化率）。</li>
<li><strong>全局配置</strong>：统一处理路由错误（如 404 页面跳转）、添加全局加载状态（如路由切换时显示 loading）。</li>
</ol>
<p>这里我们写的路由守卫是最简单的一种 即当用户路由错误的时候 我们跳转到 404 页面 （关于路由鉴权的部分我们已经用动态路由实现了）</p>
<h3 id="注册全局前置守卫"><a href="#注册全局前置守卫" class="headerlink" title="注册全局前置守卫"></a>注册全局前置守卫</h3><p>在<strong>main.js</strong>中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getRoutes获得所有路由记录的完整列表。</span></span><br><span class="line"><span class="comment">//这个方法判断要跳转的路由是否存在</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isRoute</span>(<span class="params">to</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> router.<span class="title function_">getRoutes</span>().<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">path</span> === to.<span class="property">path</span>).<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//如果要跳转的不是login,且token不存在(可以通过不存在token判断出用户未登录)</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> !== <span class="string">&quot;/login&quot;</span> &amp;&amp; !store.<span class="property">state</span>.<span class="property">token</span>) &#123;</span><br><span class="line">    <span class="comment">//跳转到login</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&quot;login&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//如果路由记录不存在</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isRoute</span>(to)) &#123;</span><br><span class="line">    <span class="comment">//跳转到404界面</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&quot;404&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>下面介绍一下这两段代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isRoute</span>(<span class="params">to</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> router.<span class="title function_">getRoutes</span>().<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">path</span> === to.<span class="property">path</span>).<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取所有已配置的路由记录，筛选出与目标路径完全匹配的路由</p>
<ul>
<li>作用：检查目标路由（<code>to</code>）是否在项目已配置的路由列表中。</li>
<li>原理：<ul>
<li><code>router.getRoutes()</code>：Vue Router 提供的方法，返回所有路由记录的完整列表。</li>
<li>通过 <code>filter</code> 筛选出路径（<code>path</code>）与目标路由完全一致的记录。</li>
<li>如果匹配到至少 1 条记录（<code>length &gt; 0</code>），则返回 <code>true</code>（路由存在），否则返回 <code>false</code>（路由不存在）。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 规则1：未登录用户访问非登录页时，强制跳转到登录页</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> !== <span class="string">&quot;/login&quot;</span> &amp;&amp; !store.<span class="property">state</span>.<span class="property">token</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&quot;login&quot;</span> &#125;; <span class="comment">// 跳转到名为 login 的路由</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 规则2：如果目标路由不存在，跳转到 404 页面</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isRoute</span>(to)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&quot;404&quot;</span> &#125;; <span class="comment">// 跳转到名为 404 的路由</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这是 Vue Router 中最常用的全局守卫，会在<strong>每次路由跳转前触发</strong>，用于拦截或放行路由。</p>
<ol>
<li><strong>登录权限控制</strong>：<ul>
<li>条件：<code>to.path !== &#39;/login&#39;</code>（目标路由不是登录页）且 <code>!store.state.token</code>（没有登录凭证，即未登录）。</li>
<li>处理：强制跳转到登录页（通过路由名称 <code>login</code> 定位），阻止未登录用户访问受保护页面。</li>
</ul>
</li>
<li><strong>路由有效性校验</strong>：<ul>
<li>条件：<code>!isRoute(to)</code>（目标路由不在配置的路由列表中）。</li>
<li>处理：跳转到 404 页面（通过路由名称 <code>404</code> 定位），避免用户访问不存在的路由时出现空白或错误。</li>
</ul>
</li>
</ol>
<p>在这里我们介绍一下这里传入的 to 到底是什么 这也是我在复盘代码的时候没有搞懂的东西</p>
<p>当你在应用中进行路由跳转时（比如通过 <code>&lt;router-link&gt;</code> 点击、<code>this.$router.push()</code> 调用等），Vue Router 内部会：</p>
<ol>
<li>解析目标路由信息，生成一个<strong>路由记录对象（Route Location）</strong>，也就是 <code>to</code></li>
<li>同时获取当前所在的路由信息，生成 <code>from</code> 对象</li>
<li>自动将 <code>to</code> 和 <code>from</code> 作为参数传入 <code>beforeEach</code> 守卫函数</li>
</ol>
<p>简单说：<strong>任何触发路由变化的操作，都会让路由系统自动创建 <code>to</code> 对象并传入守卫</strong>。</p>
<p><code>to</code> 包含了目标路由的完整信息，常用属性：</p>
<ul>
<li><code>path</code>：目标路由的路径（如 <code>/user</code>）</li>
<li><code>name</code>：目标路由的名称（如果定义了 <code>name</code>）</li>
<li><code>params</code>：动态路由参数（如 <code>/user/:id</code> 中的 <code>id</code>）</li>
<li><code>query</code>：查询参数（如 <code>?page=1&amp;size=10</code>）</li>
<li><code>meta</code>：路由元信息（自定义的额外数据）</li>
</ul>
<p>这里的 from 简单来说就是跳转前的路由状态 一般是用来写一些判断 比如说 from 是编辑页 我们做一个内容是否保存的判断等等</p>
<p>这里因为没有例子所以就不再多说了喵</p>
<h3 id="创建-404-页面作为守卫跳转页"><a href="#创建-404-页面作为守卫跳转页" class="headerlink" title="创建 404 页面作为守卫跳转页"></a>创建 404 页面作为守卫跳转页</h3><p>1.创建路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">//也是一级路由</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/404&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;404&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;@/views/404.vue&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>2.在 views 下创建 404.vue 页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;exception&quot;&gt;</span><br><span class="line">    &lt;img :src=&quot;getImageUrl(404)&quot; /&gt;</span><br><span class="line">    &lt;el-button class=&quot;btn-home&quot; @click=&quot;goHome&quot;&gt;回到上一个页面&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useRouter &#125; from &quot;vue-router&quot;;</span><br><span class="line">const router = useRouter();</span><br><span class="line"></span><br><span class="line">const getImageUrl = (img) =&gt; &#123;</span><br><span class="line">  return new URL(`../assets/images/$&#123;img&#125;.png`, import.meta.url).href;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const goHome = () =&gt; &#123;</span><br><span class="line">  //go方法：按指定方向访问历史。如果是正数则是路由记录向前跳转，如果是负数则是向后回退</span><br><span class="line">  //这里我们回退两个页面到跳转前的页面</span><br><span class="line">  router.go(-2);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot;&gt;</span><br><span class="line">.exception &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  img &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100vh;</span><br><span class="line">  &#125;</span><br><span class="line">  .btn-home &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    left: 50%;</span><br><span class="line">    bottom: 100px;</span><br><span class="line">    margin-left: -34px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="一些细节-bug-的修改"><a href="#一些细节-bug-的修改" class="headerlink" title="一些细节 bug 的修改"></a>一些细节 bug 的修改</h2><h3 id="解决退出登录后-tab-标签不更新"><a href="#解决退出登录后-tab-标签不更新" class="headerlink" title="解决退出登录后 tab 标签不更新"></a>解决退出登录后 tab 标签不更新</h3><p>我们用的是动态路由 并且将路由添加到 pinia 中的状态中 故而当我们切换账号的时候 之前的路由还缓存在 list 中 这也影响了 tag 会延续之前点击的 menu 为了解决这个状态残留问题 我们在 pinia 中写一个 clean 方法用来清除原状态</p>
<h4 id="pinia-中的-clean-方法"><a href="#pinia-中的-clean-方法" class="headerlink" title="pinia 中的 clean 方法"></a>pinia 中的 clean 方法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useAllDataStore = <span class="title function_">defineStore</span>(<span class="string">&quot;allData&quot;</span>, <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 定义重置方法（注：函数名应为 clear，可能是拼写笔误）</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">clean</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 清除动态添加的路由</span></span><br><span class="line">    state.<span class="property">value</span>.<span class="property">routeList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item) <span class="title function_">item</span>(); <span class="comment">// 执行每个路由的删除方法</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 重置仓库状态为初始值</span></span><br><span class="line">    state.<span class="property">value</span> = <span class="title function_">initState</span>(); <span class="comment">// initState() 是返回初始状态的函数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 删除本地缓存的状态数据</span></span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;store&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; clearn &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>清除动态路由</strong>：项目中可能通过 “动态路由” 生成菜单（例如根据用户权限加载不同菜单），<code>state.value.routeList</code> 中保存的是 “删除这些动态路由的方法”（通常是路由系统提供的移除函数）。遍历执行这些方法，能彻底删除上一次登录时添加的路由，避免重新登录时残留旧菜单路由。</li>
<li><strong>重置仓库状态</strong>：<code>initState()</code> 是一个预设的函数，返回仓库的初始状态（例如空的菜单列表、空的标签页数据等）。将 <code>state.value</code> 重置为初始值，会清空内存中保存的所有用户相关状态（如菜单、标签页、用户信息等）。</li>
<li><strong>删除本地缓存</strong>：若项目将仓库状态持久化到 <code>localStorage</code>（以 <code>store</code> 为键），退出时删除该缓存，可避免重新登录时从本地读取旧状态数据。</li>
</ul>
<h4 id="头部组件中的-handleLoginOut-方法（触发退出流程）"><a href="#头部组件中的-handleLoginOut-方法（触发退出流程）" class="headerlink" title="头部组件中的 handleLoginOut 方法（触发退出流程）"></a>头部组件中的 <code>handleLoginOut</code> 方法（触发退出流程）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CommonHeader.vue 中的退出登录处理</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleLoginOut</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1. 调用仓库的清除方法，清空所有状态和路由</span></span><br><span class="line">  store.<span class="title function_">clean</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 跳转到登录页</span></span><br><span class="line">  router.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="解决重新登陆后页面为空"><a href="#解决重新登陆后页面为空" class="headerlink" title="解决重新登陆后页面为空"></a>解决重新登陆后页面为空</h3><p>这其实是一个动态路由的顺序问题 由于我们用的是动态路由添加路由 所以我们应该首先手动添加后才能对 router 进行操作 简单来说 是我们需要 <strong>先添加路由再跳转页面</strong></p>
<p>修改<code>Login.vue</code>中的<code>handleLogin</code>方法，调整路由添加和页面跳转的顺序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">// ... 其他代码保持不变</span><br><span class="line"></span><br><span class="line">const handleLogin = async () =&gt; &#123;</span><br><span class="line">  const res = await proxy.$api.getMenu(loginForm);</span><br><span class="line">  if (res) &#123;</span><br><span class="line">    // 1. 先更新菜单列表</span><br><span class="line">    store.updateMenuList(res.menuList);</span><br><span class="line">    // 2. 保存token</span><br><span class="line">    store.state.token = res.token;</span><br><span class="line">    // 3. 先添加路由（关键修复：确保路由先添加再跳转）</span><br><span class="line">    store.addMenu(router);</span><br><span class="line">    // 4. 最后跳转到首页</span><br><span class="line">    router.push(&quot;/home&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>原来的代码是先跳转再添加路由，这在第一次登录时可能侥幸正常工作，但在重新登录时会出现时序问题：路由还未添加就已经跳转，导致组件无法加载。</p>
<p>调整顺序后，确保了路由先被正确添加到路由系统中，然后再进行页面跳转，此时路由匹配就能找到对应的组件了。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">NJY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE/">http://example.com/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">NJYgocrazy</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/Vue3/">Vue3</a></div><div class="post-share"><div class="social-share" data-image="https://s21.ax1x.com/2025/09/22/pV5SCUs.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%88%B7%E9%A2%98%E6%80%BB%E7%BB%932.0/" title="刷题小记--从下笔到遗忘"><img class="cover" src="https://s21.ax1x.com/2025/06/23/pVZxHaD.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">刷题小记--从下笔到遗忘</div></div><div class="info-2"><div class="info-item-1">刷题吗？我只看到一个绝望的算法最菜之人</div></div></div></a><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84markdown%E5%8F%8C%E8%A7%86%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8/" title="实现一个简单的markdown双视图编辑器"><img class="cover" src="https://s21.ax1x.com/2025/09/22/pV4zjv8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">实现一个简单的markdown双视图编辑器</div></div><div class="info-2"><div class="info-item-1">markdown双视图编辑器</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/Vue3/" title="Vue3基础"><img class="cover" src="https://s21.ax1x.com/2025/09/22/pV4zO8P.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-22</div><div class="info-item-2">Vue3基础</div></div><div class="info-2"><div class="info-item-1">Vue3基础用法与API</div></div></div></a><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/1.HTML/" title="HTML笔记"><img class="cover" src="https://s21.ax1x.com/2025/06/23/pVZxhx1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-22</div><div class="info-item-2">HTML笔记</div></div><div class="info-2"><div class="info-item-1">HTML的初步学习！</div></div></div></a><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/CSS/" title="CSS笔记"><img class="cover" src="https://s21.ax1x.com/2025/06/23/pVZxIr6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-22</div><div class="info-item-2">CSS笔记</div></div><div class="info-2"><div class="info-item-1">CSS的初步学习！</div></div></div></a><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/JavaScript%E5%9F%BA%E7%A1%80/" title="JavaScript基础"><img class="cover" src="https://s21.ax1x.com/2025/06/23/pVe9ZQA.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-22</div><div class="info-item-2">JavaScript基础</div></div><div class="info-2"><div class="info-item-1">JavaScript基础学习</div></div></div></a><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84markdown%E5%8F%8C%E8%A7%86%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8/" title="实现一个简单的markdown双视图编辑器"><img class="cover" src="https://s21.ax1x.com/2025/09/22/pV4zjv8.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-22</div><div class="info-item-2">实现一个简单的markdown双视图编辑器</div></div><div class="info-2"><div class="info-item-1">markdown双视图编辑器</div></div></div></a><a class="pagination-related" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E7%AB%A5%E5%B9%B4%E5%9B%9E%E5%BF%86-%E7%B1%BB%E5%8A%A0%E9%80%9F%E7%90%83%E7%9A%84%E6%B0%B4%E7%90%83%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/" title="实现一个小水球动画"><img class="cover" src="https://s21.ax1x.com/2025/06/23/pVe9FiD.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-22</div><div class="info-item-2">实现一个小水球动画</div></div><div class="info-2"><div class="info-item-1">用原生js实现一个小水球动画！</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/ava.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">NJY</div><div class="author-info-description">LEC SWPU 前端</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">后台管理项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.1.</span> <span class="toc-text">技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%81%8C%E8%B4%A3"><span class="toc-number">1.2.</span> <span class="toc-text">项目职责</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%8F%82%E4%B8%8E-v-for"><span class="toc-number">1.3.</span> <span class="toc-text">计算属性参与 v-for</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%90%E8%AE%A1%E7%AE%97"><span class="toc-number">1.3.1.</span> <span class="toc-text">数据源计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%90%E5%8C%BA%E5%88%AB"><span class="toc-number">1.3.2.</span> <span class="toc-text">数据源区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mockjs"><span class="toc-number">1.4.</span> <span class="toc-text">mockjs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#axios-%E8%AF%B7%E6%B1%82"><span class="toc-number">1.5.</span> <span class="toc-text">axios 请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85"><span class="toc-number">1.5.2.</span> <span class="toc-text">二次封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.3.</span> <span class="toc-text">引入配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#echarts-%E8%A1%A8%E6%A0%BC"><span class="toc-number">1.6.</span> <span class="toc-text">echarts 表格</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.6.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%A1%A8%E6%A0%BC%E6%A0%B7%E5%BC%8F%E4%B8%8E%E6%95%B0%E6%8D%AE"><span class="toc-number">1.6.2.</span> <span class="toc-text">配置表格样式与数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%9B%BE%E8%A1%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">渲染图表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%AE%B9%E5%99%A8%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-number">1.6.4.</span> <span class="toc-text">响应容器大小的变化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">1.7.</span> <span class="toc-text">实现搜索功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="toc-number">1.7.1.</span> <span class="toc-text">页面结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%BE%93%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.2.</span> <span class="toc-text">处理输入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E9%80%BB%E8%BE%91"><span class="toc-number">1.7.3.</span> <span class="toc-text">搜索逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E4%B8%8E%E6%B8%B2%E6%9F%93"><span class="toc-number">1.7.4.</span> <span class="toc-text">数据请求与渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD"><span class="toc-number">1.8.</span> <span class="toc-text">实现分页功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84-1"><span class="toc-number">1.8.1.</span> <span class="toc-text">页面结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%8F%82%E6%95%B0%E7%AE%A1%E7%90%86"><span class="toc-number">1.8.2.</span> <span class="toc-text">分页参数管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E7%A0%81%E5%88%87%E6%8D%A2%E9%80%BB%E8%BE%91"><span class="toc-number">1.8.3.</span> <span class="toc-text">页码切换逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">1.9.</span> <span class="toc-text">实现删除功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84-2"><span class="toc-number">1.9.1.</span> <span class="toc-text">页面结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API-%E5%B0%81%E8%A3%85"><span class="toc-number">1.9.2.</span> <span class="toc-text">API 封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%80%BB%E8%BE%91"><span class="toc-number">1.9.3.</span> <span class="toc-text">删除逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B0%E5%A2%9E%E4%B8%8E%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-number">1.10.</span> <span class="toc-text">实现新增与编辑功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.1.</span> <span class="toc-text">总页面结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E9%83%A8%E5%88%86"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">对话框部分</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%B8%8E%E8%A1%A8%E5%8D%95%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.10.2.</span> <span class="toc-text">对话框与表单事件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">新增功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">编辑功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%A0%87%E7%AD%BE%E5%AF%BC%E8%88%AA%E5%8A%9F%E8%83%BD"><span class="toc-number">1.11.</span> <span class="toc-text">实现标签导航功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pinia-%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">1.11.1.</span> <span class="toc-text">pinia 实现状态管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E7%BB%84%E4%BB%B6"><span class="toc-number">1.11.2.</span> <span class="toc-text">标签组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E5%92%8C%E8%B7%AF%E7%94%B1%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.11.3.</span> <span class="toc-text">标签和路由之间的关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">1.11.3.1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1"><span class="toc-number">1.11.3.2.</span> <span class="toc-text"></span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E9%9D%A2%E5%8C%85%E5%B1%91%E5%8A%9F%E8%83%BD"><span class="toc-number">1.12.</span> <span class="toc-text">实现面包屑功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84-3"><span class="toc-number">1.12.1.</span> <span class="toc-text">页面结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">1.12.2.</span> <span class="toc-text">数据处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.13.</span> <span class="toc-text">实现登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E7%9A%84%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">1.13.1.</span> <span class="toc-text">登录页面的静态结构搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pinia-%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%BA%94"><span class="toc-number">1.13.2.</span> <span class="toc-text">pinia 传递数据实现对应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E8%BF%9B%E8%A1%8C%E8%B7%AF%E7%94%B1%E9%89%B4%E6%9D%83"><span class="toc-number">1.14.</span> <span class="toc-text">实现动态路由进行路由鉴权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%B8%BA%E5%89%8D%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">1.14.1.</span> <span class="toc-text">格式化后端数据为前端配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E6%B8%85%E7%90%86%E5%92%8C%E9%87%8D%E6%96%B0%E6%B7%BB%E5%8A%A0"><span class="toc-number">1.14.2.</span> <span class="toc-text">路由的清理和重新添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">1.14.3.</span> <span class="toc-text">登录调用方法实现动态路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%8C%81%E4%B9%85%E5%8C%96%E5%82%A8%E5%AD%98-pinia-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.15.</span> <span class="toc-text">实现持久化储存 pinia 数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96%E8%A1%A8%E5%B9%B6%E4%BF%9D%E5%AD%98%E5%88%B0-localStorage"><span class="toc-number">1.15.1.</span> <span class="toc-text">监听状态变化表并保存到 localStorage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E6%97%B6%E9%87%8D%E6%96%B0%E8%AF%BB%E5%8F%96-localStorage"><span class="toc-number">1.15.2.</span> <span class="toc-text">页面刷新时重新读取 localStorage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%90%AF%E5%8A%A8%E7%8A%B6%E6%80%81%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.15.3.</span> <span class="toc-text">全局启动状态持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB"><span class="toc-number">1.16.</span> <span class="toc-text">实现路由守卫</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB"><span class="toc-number">1.16.1.</span> <span class="toc-text">注册全局前置守卫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-404-%E9%A1%B5%E9%9D%A2%E4%BD%9C%E4%B8%BA%E5%AE%88%E5%8D%AB%E8%B7%B3%E8%BD%AC%E9%A1%B5"><span class="toc-number">1.16.2.</span> <span class="toc-text">创建 404 页面作为守卫跳转页</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%BB%86%E8%8A%82-bug-%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">1.17.</span> <span class="toc-text">一些细节 bug 的修改</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%90%8E-tab-%E6%A0%87%E7%AD%BE%E4%B8%8D%E6%9B%B4%E6%96%B0"><span class="toc-number">1.17.1.</span> <span class="toc-text">解决退出登录后 tab 标签不更新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pinia-%E4%B8%AD%E7%9A%84-clean-%E6%96%B9%E6%B3%95"><span class="toc-number">1.17.1.1.</span> <span class="toc-text">pinia 中的 clean 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E7%9A%84-handleLoginOut-%E6%96%B9%E6%B3%95%EF%BC%88%E8%A7%A6%E5%8F%91%E9%80%80%E5%87%BA%E6%B5%81%E7%A8%8B%EF%BC%89"><span class="toc-number">1.17.1.2.</span> <span class="toc-text">头部组件中的 handleLoginOut 方法（触发退出流程）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%87%8D%E6%96%B0%E7%99%BB%E9%99%86%E5%90%8E%E9%A1%B5%E9%9D%A2%E4%B8%BA%E7%A9%BA"><span class="toc-number">1.17.2.</span> <span class="toc-text">解决重新登陆后页面为空</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE/" title="后台管理项目"><img src="https://s21.ax1x.com/2025/09/22/pV5SCUs.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="后台管理项目"/></a><div class="content"><a class="title" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%89%8D%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE/" title="后台管理项目">后台管理项目</a><time datetime="2025-09-22T12:54:20.521Z" title="发表于 2025-09-22 12:54:20">2025-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84markdown%E5%8F%8C%E8%A7%86%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8/" title="实现一个简单的markdown双视图编辑器"><img src="https://s21.ax1x.com/2025/09/22/pV4zjv8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实现一个简单的markdown双视图编辑器"/></a><div class="content"><a class="title" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84markdown%E5%8F%8C%E8%A7%86%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8/" title="实现一个简单的markdown双视图编辑器">实现一个简单的markdown双视图编辑器</a><time datetime="2025-09-22T12:54:20.521Z" title="发表于 2025-09-22 12:54:20">2025-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E6%A0%91/" title="树"><img src="https://s21.ax1x.com/2025/04/29/pE7rNAU.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="树"/></a><div class="content"><a class="title" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E6%A0%91/" title="树">树</a><time datetime="2025-09-22T12:54:20.521Z" title="发表于 2025-09-22 12:54:20">2025-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E7%AB%A5%E5%B9%B4%E5%9B%9E%E5%BF%86-%E7%B1%BB%E5%8A%A0%E9%80%9F%E7%90%83%E7%9A%84%E6%B0%B4%E7%90%83%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/" title="实现一个小水球动画"><img src="https://s21.ax1x.com/2025/06/23/pVe9FiD.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实现一个小水球动画"/></a><div class="content"><a class="title" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E7%AB%A5%E5%B9%B4%E5%9B%9E%E5%BF%86-%E7%B1%BB%E5%8A%A0%E9%80%9F%E7%90%83%E7%9A%84%E6%B0%B4%E7%90%83%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/" title="实现一个小水球动画">实现一个小水球动画</a><time datetime="2025-09-22T12:54:20.521Z" title="发表于 2025-09-22 12:54:20">2025-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E7%AE%97%E6%B3%95/" title="算法--从入门到出门"><img src="https://s21.ax1x.com/2025/06/23/pVZxcaF.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="算法--从入门到出门"/></a><div class="content"><a class="title" href="/2025/09/22/%E6%9C%AA%E5%91%BD%E5%90%8D%201/%E7%AE%97%E6%B3%95/" title="算法--从入门到出门">算法--从入门到出门</a><time datetime="2025-09-22T12:54:20.521Z" title="发表于 2025-09-22 12:54:20">2025-09-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By NJY</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script> $(".category-list-count").prepend("<i class=\"fas fa-book\"></i>");</script><script> $(".category-list-item").eq(0).insertAfter($(".gallery-group-name").eq(0))</script><script> $(".category-list-item").eq(1).insertAfter($(".gallery-group-name").eq(1))</script><script> $(".category-list-item").eq(2).insertAfter($(".gallery-group-name").eq(2))</script><script> $(".category-list-item").eq(3).insertAfter($(".gallery-group-name").eq(3))</script><script> $(".category-list-item").eq(4).insertAfter($(".gallery-group-name").eq(4))</script><script> $(".category-list-item").eq(5).insertAfter($(".gallery-group-name").eq(5))</script><script> $(".category-list-item a").hide();</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="N,LOVE,T" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://s21.ax1x.com/2025/06/23/pVe9ueP.png);"> <a class="categoryBar-list-link" href="categories/前端/">前端</a><span class="categoryBar-list-count">7</span><span class="categoryBar-list-descr">前端成长历程</span></li><li class="categoryBar-list-item" style="background:url(https://s21.ax1x.com/2025/06/23/pVe9Tld.jpg);"> <a class="categoryBar-list-link" href="categories/苦吟/">苦吟</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">苦吟的文学世界</span></li><li class="categoryBar-list-item" style="background:url(https://s21.ax1x.com/2025/06/23/pVe9L0P.png);"> <a class="categoryBar-list-link" href="categories/算法/">算法</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">算法</span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><!-- hexo injector body_end end --></body></html>